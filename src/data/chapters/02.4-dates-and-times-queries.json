[
  {
    "id": "02.4-dates-and-times-0",
    "originalQuery": "-- The magic number: days from December 31, 1840\nSELECT \n  DATE('1840-12-31') as epic_epoch,\n  JULIANDAY('1840-12-31') as julian_day_number,\n  DATE('1840-12-31', '+1 day') as day_one",
    "description": "Verify the Epic epoch date",
    "chapterId": "02.4-dates-and-times",
    "index": 0,
    "results": [
      {
        "epic_epoch": "1840-12-31",
        "julian_day_number": 2393470.5,
        "day_one": "1841-01-01"
      }
    ],
    "columns": [
      "epic_epoch",
      "julian_day_number",
      "day_one"
    ],
    "error": null
  },
  {
    "id": "02.4-dates-and-times-1",
    "originalQuery": "SELECT \n  PAT_ENC_DATE_REAL,\n  CAST(PAT_ENC_DATE_REAL AS INTEGER) as days_since_epoch,\n  ROUND((PAT_ENC_DATE_REAL - CAST(PAT_ENC_DATE_REAL AS INTEGER)) * 100) as sequence_number,\n  CONTACT_DATE as epic_formatted_date\nFROM pat_enc\nWHERE PAT_ENC_DATE_REAL IS NOT NULL\nLIMIT 10",
    "description": "Examine PAT_ENC_DATE_REAL structure",
    "chapterId": "02.4-dates-and-times",
    "index": 1,
    "results": [
      {
        "PAT_ENC_DATE_REAL": 64869,
        "days_since_epoch": 64869,
        "sequence_number": 0,
        "epic_formatted_date": "8/9/2018 12:00:00 AM"
      },
      {
        "PAT_ENC_DATE_REAL": 64869.01,
        "days_since_epoch": 64869,
        "sequence_number": 1,
        "epic_formatted_date": "8/9/2018 12:00:00 AM"
      },
      {
        "PAT_ENC_DATE_REAL": 64869.02,
        "days_since_epoch": 64869,
        "sequence_number": 2,
        "epic_formatted_date": "8/9/2018 12:00:00 AM"
      },
      {
        "PAT_ENC_DATE_REAL": 64869.03,
        "days_since_epoch": 64869,
        "sequence_number": 3,
        "epic_formatted_date": "8/9/2018 12:00:00 AM"
      },
      {
        "PAT_ENC_DATE_REAL": 64878,
        "days_since_epoch": 64878,
        "sequence_number": 0,
        "epic_formatted_date": "8/18/2018 12:00:00 AM"
      },
      {
        "PAT_ENC_DATE_REAL": 64888,
        "days_since_epoch": 64888,
        "sequence_number": 0,
        "epic_formatted_date": "8/28/2018 12:00:00 AM"
      },
      {
        "PAT_ENC_DATE_REAL": 64946,
        "days_since_epoch": 64946,
        "sequence_number": 0,
        "epic_formatted_date": "10/25/2018 12:00:00 AM"
      },
      {
        "PAT_ENC_DATE_REAL": 64977,
        "days_since_epoch": 64977,
        "sequence_number": 0,
        "epic_formatted_date": "11/25/2018 12:00:00 AM"
      },
      {
        "PAT_ENC_DATE_REAL": 65007,
        "days_since_epoch": 65007,
        "sequence_number": 0,
        "epic_formatted_date": "12/25/2018 12:00:00 AM"
      },
      {
        "PAT_ENC_DATE_REAL": 65038,
        "days_since_epoch": 65038,
        "sequence_number": 0,
        "epic_formatted_date": "1/25/2019 12:00:00 AM"
      }
    ],
    "columns": [
      "PAT_ENC_DATE_REAL",
      "days_since_epoch",
      "sequence_number",
      "epic_formatted_date"
    ],
    "error": null
  },
  {
    "id": "02.4-dates-and-times-2",
    "originalQuery": "SELECT \n  PAT_ENC_CSN_ID,\n  PAT_ENC_DATE_REAL,\n  -- Convert to ISO date\n  DATE('1840-12-31', '+' || CAST(PAT_ENC_DATE_REAL AS INTEGER) || ' days') as iso_date,\n  -- Extract time portion (sequence)\n  CASE \n    WHEN PAT_ENC_DATE_REAL = CAST(PAT_ENC_DATE_REAL AS INTEGER) THEN 'First/Only'\n    ELSE 'Sequence #' || CAST(ROUND((PAT_ENC_DATE_REAL - CAST(PAT_ENC_DATE_REAL AS INTEGER)) * 100) AS INTEGER)\n  END as visit_sequence\nFROM pat_enc\nWHERE PAT_ENC_DATE_REAL IS NOT NULL\nORDER BY PAT_ENC_DATE_REAL\nLIMIT 20",
    "description": "Convert Epic dates to ISO format",
    "chapterId": "02.4-dates-and-times",
    "index": 2,
    "results": [
      {
        "PAT_ENC_CSN_ID": 720803470,
        "PAT_ENC_DATE_REAL": 64869,
        "iso_date": "2018-08-09",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 724619887,
        "PAT_ENC_DATE_REAL": 64869.01,
        "iso_date": "2018-08-09",
        "visit_sequence": "Sequence #1"
      },
      {
        "PAT_ENC_CSN_ID": 724623985,
        "PAT_ENC_DATE_REAL": 64869.02,
        "iso_date": "2018-08-09",
        "visit_sequence": "Sequence #2"
      },
      {
        "PAT_ENC_CSN_ID": 724628999,
        "PAT_ENC_DATE_REAL": 64869.03,
        "iso_date": "2018-08-09",
        "visit_sequence": "Sequence #3"
      },
      {
        "PAT_ENC_CSN_ID": 725327197,
        "PAT_ENC_DATE_REAL": 64878,
        "iso_date": "2018-08-18",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 727947624,
        "PAT_ENC_DATE_REAL": 64888,
        "iso_date": "2018-08-28",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 736485409,
        "PAT_ENC_DATE_REAL": 64946,
        "iso_date": "2018-10-25",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 740764099,
        "PAT_ENC_DATE_REAL": 64977,
        "iso_date": "2018-11-25",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 745238411,
        "PAT_ENC_DATE_REAL": 65007,
        "iso_date": "2018-12-25",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 749745972,
        "PAT_ENC_DATE_REAL": 65038,
        "iso_date": "2019-01-25",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 750474644,
        "PAT_ENC_DATE_REAL": 65045,
        "iso_date": "2019-02-01",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 754166145,
        "PAT_ENC_DATE_REAL": 65069,
        "iso_date": "2019-02-25",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 758599939,
        "PAT_ENC_DATE_REAL": 65097,
        "iso_date": "2019-03-25",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 763443168,
        "PAT_ENC_DATE_REAL": 65128,
        "iso_date": "2019-04-25",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 768007053,
        "PAT_ENC_DATE_REAL": 65158,
        "iso_date": "2019-05-25",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 772693619,
        "PAT_ENC_DATE_REAL": 65189,
        "iso_date": "2019-06-25",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 777174829,
        "PAT_ENC_DATE_REAL": 65219,
        "iso_date": "2019-07-25",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 781842097,
        "PAT_ENC_DATE_REAL": 65250,
        "iso_date": "2019-08-25",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 787137346,
        "PAT_ENC_DATE_REAL": 65284,
        "iso_date": "2019-09-28",
        "visit_sequence": "First/Only"
      },
      {
        "PAT_ENC_CSN_ID": 791983409,
        "PAT_ENC_DATE_REAL": 65311,
        "iso_date": "2019-10-25",
        "visit_sequence": "First/Only"
      }
    ],
    "columns": [
      "PAT_ENC_CSN_ID",
      "PAT_ENC_DATE_REAL",
      "iso_date",
      "visit_sequence"
    ],
    "error": null
  },
  {
    "id": "02.4-dates-and-times-3",
    "originalQuery": "SELECT \n  pe.PAT_ID,\n  DATE('1840-12-31', '+' || CAST(pe.PAT_ENC_DATE_REAL AS INTEGER) || ' days') as encounter_date,\n  COUNT(*) as visits_that_day,\n  GROUP_CONCAT(\n    PRINTF('%.2f', pe.PAT_ENC_DATE_REAL) || ' (' || COALESCE(d.DEPARTMENT_NAME, 'Unknown') || ')',\n    ', '\n  ) as encounter_details\nFROM pat_enc pe\nLEFT JOIN CLARITY_DEP d ON pe.DEPARTMENT_ID = d.DEPARTMENT_ID\nWHERE pe.PAT_ENC_DATE_REAL IS NOT NULL\nGROUP BY pe.PAT_ID, CAST(pe.PAT_ENC_DATE_REAL AS INTEGER)\nHAVING COUNT(*) > 1\nORDER BY visits_that_day DESC, encounter_date DESC\nLIMIT 10",
    "description": "Find patients with multiple same-day encounters",
    "chapterId": "02.4-dates-and-times",
    "index": 3,
    "results": [
      {
        "PAT_ID": "Z7004242",
        "encounter_date": "2023-09-28",
        "visits_that_day": 4,
        "encounter_details": "66745.00 (MAC APL INTERNAL MEDICINE), 66745.01 (MAC APL INTERNAL MEDICINE), 66745.02 (MAC APL LABORATORY), 66745.03 (MAC APL INTERNAL MEDICINE)"
      },
      {
        "PAT_ID": "Z7004242",
        "encounter_date": "2020-07-21",
        "visits_that_day": 4,
        "encounter_details": "65581.00 (MAC APL INTERNAL MEDICINE), 65581.01 (Unknown), 65581.02 (MAC APL INTERNAL MEDICINE), 65581.03 (MAC APL INTERNAL MEDICINE)"
      },
      {
        "PAT_ID": "Z7004242",
        "encounter_date": "2018-08-09",
        "visits_that_day": 4,
        "encounter_details": "64869.00 (MAC APL INTERNAL MEDICINE), 64869.01 (MAC APL BUSINESS SERVICES), 64869.02 (MAC APL INTERNAL MEDICINE), 64869.03 (MAC APL LABORATORY)"
      },
      {
        "PAT_ID": "Z7004242",
        "encounter_date": "2023-03-02",
        "visits_that_day": 3,
        "encounter_details": "66535.00 (MAC APL INTERNAL MEDICINE), 66535.01 (Unknown), 66535.02 (MAC APL INTERNAL MEDICINE)"
      },
      {
        "PAT_ID": "Z7004242",
        "encounter_date": "2022-08-29",
        "visits_that_day": 3,
        "encounter_details": "66350.00 (MAC APL INTERNAL MEDICINE), 66350.01 (MAC APL INTERNAL MEDICINE), 66350.02 (MAC APL LABORATORY)"
      },
      {
        "PAT_ID": "Z7004242",
        "encounter_date": "2022-03-11",
        "visits_that_day": 3,
        "encounter_details": "66179.00 (MHM OT NEURO CENTRAL), 66179.01 (GENERIC EXTERNAL DATA DEPARTMENT), 66179.02 (Unknown)"
      },
      {
        "PAT_ID": "Z7004242",
        "encounter_date": "2020-07-15",
        "visits_that_day": 3,
        "encounter_details": "65575.00 (MAC APL INTERNAL MEDICINE), 65575.01 (MAC APL INTERNAL MEDICINE), 65575.02 (MAC APL INTERNAL MEDICINE)"
      },
      {
        "PAT_ID": "Z7004242",
        "encounter_date": "2020-07-14",
        "visits_that_day": 3,
        "encounter_details": "65574.00 (MAC APL INTERNAL MEDICINE), 65574.01 (Unknown), 65574.02 (Unknown)"
      },
      {
        "PAT_ID": "Z7004242",
        "encounter_date": "2022-12-01",
        "visits_that_day": 2,
        "encounter_details": "66444.00 (MAC APL INTERNAL MEDICINE), 66444.01 (Unknown)"
      },
      {
        "PAT_ID": "Z7004242",
        "encounter_date": "2022-03-22",
        "visits_that_day": 2,
        "encounter_details": "66190.00 (MHM OT NEURO CENTRAL), 66190.01 (Unknown)"
      }
    ],
    "columns": [
      "PAT_ID",
      "encounter_date",
      "visits_that_day",
      "encounter_details"
    ],
    "error": null
  },
  {
    "id": "02.4-dates-and-times-4",
    "originalQuery": "SELECT \n  name as column_name,\n  CASE \n    WHEN name LIKE '%_DATE_REAL' THEN 'Epic Decimal Format'\n    WHEN name LIKE '%_DTTM' THEN 'DateTime String'\n    WHEN name LIKE '%_TIME' THEN 'Time String' \n    WHEN name LIKE '%_DATE' AND name NOT LIKE '%_DATE_REAL' THEN 'Date String'\n    WHEN name LIKE '%_INSTANT' THEN 'Epic Instant (seconds)'\n    ELSE 'Other'\n  END as date_type,\n  type as sqlite_type\nFROM pragma_table_info('PAT_ENC')\nWHERE name LIKE '%DATE%' \n   OR name LIKE '%TIME%' \n   OR name LIKE '%DTTM%' \n   OR name LIKE '%INSTANT%'\nORDER BY date_type, column_name",
    "description": "Identify date field patterns in PAT_ENC",
    "chapterId": "02.4-dates-and-times",
    "index": 4,
    "results": [
      {
        "column_name": "CONTACT_DATE",
        "date_type": "Date String",
        "sqlite_type": "TEXT"
      },
      {
        "column_name": "ENC_CLOSE_DATE",
        "date_type": "Date String",
        "sqlite_type": "TEXT"
      },
      {
        "column_name": "LMP_DATE",
        "date_type": "Date String",
        "sqlite_type": "TEXT"
      },
      {
        "column_name": "UPDATE_DATE",
        "date_type": "Date String",
        "sqlite_type": "TEXT"
      },
      {
        "column_name": "EFFECTIVE_DATE_DTTM",
        "date_type": "DateTime String",
        "sqlite_type": "TEXT"
      },
      {
        "column_name": "PAT_ENC_DATE_REAL",
        "date_type": "Epic Decimal Format",
        "sqlite_type": "REAL"
      },
      {
        "column_name": "ENC_INSTANT",
        "date_type": "Epic Instant (seconds)",
        "sqlite_type": "TEXT"
      },
      {
        "column_name": "DISCHARGE_DATE_DT",
        "date_type": "Other",
        "sqlite_type": "TEXT"
      },
      {
        "column_name": "EFFECTIVE_DATE_DT",
        "date_type": "Other",
        "sqlite_type": "TEXT"
      },
      {
        "column_name": "HOSP_ADMSN_TIME",
        "date_type": "Time String",
        "sqlite_type": "TEXT"
      },
      {
        "column_name": "HOSP_DISCHRG_TIME",
        "date_type": "Time String",
        "sqlite_type": "TEXT"
      }
    ],
    "columns": [
      "column_name",
      "date_type",
      "sqlite_type"
    ],
    "error": null
  },
  {
    "id": "02.4-dates-and-times-5",
    "originalQuery": "SELECT \n  PAT_ENC_CSN_ID,\n  HOSP_ADMSN_TIME,\n  HOSP_DISCHRG_TIME,\n  -- Calculate length of stay in days\n  ROUND(\n    JULIANDAY(\n      SUBSTR(HOSP_DISCHRG_TIME, 7, 4) || '-' || \n      SUBSTR(HOSP_DISCHRG_TIME, 1, 2) || '-' || \n      SUBSTR(HOSP_DISCHRG_TIME, 4, 2)\n    ) - \n    JULIANDAY(\n      SUBSTR(HOSP_ADMSN_TIME, 7, 4) || '-' || \n      SUBSTR(HOSP_ADMSN_TIME, 1, 2) || '-' || \n      SUBSTR(HOSP_ADMSN_TIME, 4, 2)\n    ), 1\n  ) as length_of_stay_days\nFROM pat_enc\nWHERE HOSP_ADMSN_TIME IS NOT NULL \n  AND HOSP_DISCHRG_TIME IS NOT NULL\n  AND PAT_ENC_CSN_ID IS NOT NULL\nORDER BY length_of_stay_days DESC\nLIMIT 10",
    "description": "Calculate length of stay for hospital encounters",
    "chapterId": "02.4-dates-and-times",
    "index": 5,
    "results": [
      {
        "PAT_ENC_CSN_ID": 720803470,
        "HOSP_ADMSN_TIME": "",
        "HOSP_DISCHRG_TIME": "",
        "length_of_stay_days": null
      },
      {
        "PAT_ENC_CSN_ID": 724619887,
        "HOSP_ADMSN_TIME": "",
        "HOSP_DISCHRG_TIME": "",
        "length_of_stay_days": null
      },
      {
        "PAT_ENC_CSN_ID": 724623985,
        "HOSP_ADMSN_TIME": "",
        "HOSP_DISCHRG_TIME": "",
        "length_of_stay_days": null
      },
      {
        "PAT_ENC_CSN_ID": 724628999,
        "HOSP_ADMSN_TIME": "",
        "HOSP_DISCHRG_TIME": "",
        "length_of_stay_days": null
      },
      {
        "PAT_ENC_CSN_ID": 725327197,
        "HOSP_ADMSN_TIME": "",
        "HOSP_DISCHRG_TIME": "",
        "length_of_stay_days": null
      },
      {
        "PAT_ENC_CSN_ID": 727947624,
        "HOSP_ADMSN_TIME": "",
        "HOSP_DISCHRG_TIME": "",
        "length_of_stay_days": null
      },
      {
        "PAT_ENC_CSN_ID": 736485409,
        "HOSP_ADMSN_TIME": "",
        "HOSP_DISCHRG_TIME": "",
        "length_of_stay_days": null
      },
      {
        "PAT_ENC_CSN_ID": 740764099,
        "HOSP_ADMSN_TIME": "",
        "HOSP_DISCHRG_TIME": "",
        "length_of_stay_days": null
      },
      {
        "PAT_ENC_CSN_ID": 745238411,
        "HOSP_ADMSN_TIME": "",
        "HOSP_DISCHRG_TIME": "",
        "length_of_stay_days": null
      },
      {
        "PAT_ENC_CSN_ID": 749745972,
        "HOSP_ADMSN_TIME": "",
        "HOSP_DISCHRG_TIME": "",
        "length_of_stay_days": null
      }
    ],
    "columns": [
      "PAT_ENC_CSN_ID",
      "HOSP_ADMSN_TIME",
      "HOSP_DISCHRG_TIME",
      "length_of_stay_days"
    ],
    "error": null
  },
  {
    "id": "02.4-dates-and-times-6",
    "originalQuery": "SELECT DISTINCT \n  m.name as table_name,\n  COUNT(*) as utc_field_count\nFROM sqlite_master m\nWHERE m.type = 'table' \n  AND m.sql LIKE '%UTC%'\nGROUP BY m.name\nORDER BY utc_field_count DESC\nLIMIT 10",
    "description": "Find tables with UTC timestamp fields",
    "chapterId": "02.4-dates-and-times",
    "index": 6,
    "results": [
      {
        "table_name": "TIMEOUT_ANSWERS_2",
        "utc_field_count": 1
      },
      {
        "table_name": "SDD_ENTRIES",
        "utc_field_count": 1
      },
      {
        "table_name": "RIS_SGND_INFO",
        "utc_field_count": 1
      },
      {
        "table_name": "REFERRAL_APT",
        "utc_field_count": 1
      },
      {
        "table_name": "PT_GOALS_UPDATES",
        "utc_field_count": 1
      },
      {
        "table_name": "PAT_ENC_HSP_2",
        "utc_field_count": 1
      },
      {
        "table_name": "PAT_ENC_ELIG_HISTORY",
        "utc_field_count": 1
      },
      {
        "table_name": "PAT_ENC_ADMIT_DX_AUDIT",
        "utc_field_count": 1
      },
      {
        "table_name": "PAT_ENC_6",
        "utc_field_count": 1
      },
      {
        "table_name": "PAT_ENC_4",
        "utc_field_count": 1
      }
    ],
    "columns": [
      "table_name",
      "utc_field_count"
    ],
    "error": null
  },
  {
    "id": "02.4-dates-and-times-7",
    "originalQuery": "WITH date_range AS (\n  SELECT \n    JULIANDAY('2018-08-01') - JULIANDAY('1840-12-31') as start_epic,\n    JULIANDAY('2018-09-01') - JULIANDAY('1840-12-31') as end_epic\n)\nSELECT \n  pe.PAT_ENC_CSN_ID,\n  DATE('1840-12-31', '+' || CAST(pe.PAT_ENC_DATE_REAL AS INTEGER) || ' days') as encounter_date,\n  COALESCE(d.DEPARTMENT_NAME, 'Unknown') as department_name\nFROM pat_enc pe\nCROSS JOIN date_range\nLEFT JOIN CLARITY_DEP d ON pe.DEPARTMENT_ID = d.DEPARTMENT_ID\nWHERE pe.PAT_ENC_DATE_REAL >= start_epic\n  AND pe.PAT_ENC_DATE_REAL < end_epic\nORDER BY pe.PAT_ENC_DATE_REAL",
    "description": "Query encounters for a specific month efficiently",
    "chapterId": "02.4-dates-and-times",
    "index": 7,
    "results": [
      {
        "PAT_ENC_CSN_ID": 720803470,
        "encounter_date": "2018-08-09",
        "department_name": "MAC APL INTERNAL MEDICINE"
      },
      {
        "PAT_ENC_CSN_ID": 724619887,
        "encounter_date": "2018-08-09",
        "department_name": "MAC APL BUSINESS SERVICES"
      },
      {
        "PAT_ENC_CSN_ID": 724623985,
        "encounter_date": "2018-08-09",
        "department_name": "MAC APL INTERNAL MEDICINE"
      },
      {
        "PAT_ENC_CSN_ID": 724628999,
        "encounter_date": "2018-08-09",
        "department_name": "MAC APL LABORATORY"
      },
      {
        "PAT_ENC_CSN_ID": 725327197,
        "encounter_date": "2018-08-18",
        "department_name": "MAC APL LABORATORY"
      },
      {
        "PAT_ENC_CSN_ID": 727947624,
        "encounter_date": "2018-08-28",
        "department_name": "MAC APL INTERNAL MEDICINE"
      }
    ],
    "columns": [
      "PAT_ENC_CSN_ID",
      "encounter_date",
      "department_name"
    ],
    "error": null
  },
  {
    "id": "02.4-dates-and-times-8",
    "originalQuery": "SELECT \n  pe.PAT_ENC_CSN_ID,\n  DATE('1840-12-31', '+' || CAST(pe.PAT_ENC_DATE_REAL AS INTEGER) || ' days') as encounter_date,\n  p.BIRTH_DATE,\n  -- Calculate age in years\n  CAST(\n    (JULIANDAY(DATE('1840-12-31', '+' || CAST(pe.PAT_ENC_DATE_REAL AS INTEGER) || ' days')) \n     - JULIANDAY(\n         SUBSTR(p.BIRTH_DATE, 7, 4) || '-' || \n         SUBSTR(p.BIRTH_DATE, 1, 2) || '-' || \n         SUBSTR(p.BIRTH_DATE, 4, 2)\n       )) / 365.25 \n    AS INTEGER\n  ) as age_at_encounter\nFROM PAT_ENC pe\nJOIN PATIENT p ON pe.PAT_ID = p.PAT_ID\nWHERE p.BIRTH_DATE IS NOT NULL\n  AND pe.PAT_ENC_DATE_REAL IS NOT NULL\nORDER BY pe.PAT_ENC_DATE_REAL DESC\nLIMIT 20",
    "description": "Calculate patient age at each encounter",
    "chapterId": "02.4-dates-and-times",
    "index": 8,
    "results": [
      {
        "PAT_ENC_CSN_ID": 1028744231,
        "encounter_date": "2024-11-07",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 42
      },
      {
        "PAT_ENC_CSN_ID": 1054605204,
        "encounter_date": "2024-02-25",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 41
      },
      {
        "PAT_ENC_CSN_ID": 1049332896,
        "encounter_date": "2024-01-25",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 41
      },
      {
        "PAT_ENC_CSN_ID": 1044290224,
        "encounter_date": "2023-12-25",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 41
      },
      {
        "PAT_ENC_CSN_ID": 1043034397,
        "encounter_date": "2023-12-22",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 41
      },
      {
        "PAT_ENC_CSN_ID": 1039066378,
        "encounter_date": "2023-11-25",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 41
      },
      {
        "PAT_ENC_CSN_ID": 1033522365,
        "encounter_date": "2023-10-25",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 40
      },
      {
        "PAT_ENC_CSN_ID": 1031703883,
        "encounter_date": "2023-10-20",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 40
      },
      {
        "PAT_ENC_CSN_ID": 1028766353,
        "encounter_date": "2023-09-28",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 40
      },
      {
        "PAT_ENC_CSN_ID": 1028743701,
        "encounter_date": "2023-09-28",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 40
      },
      {
        "PAT_ENC_CSN_ID": 1028739468,
        "encounter_date": "2023-09-28",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 40
      },
      {
        "PAT_ENC_CSN_ID": 991225117,
        "encounter_date": "2023-09-28",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 40
      },
      {
        "PAT_ENC_CSN_ID": 1028606559,
        "encounter_date": "2023-09-27",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 40
      },
      {
        "PAT_ENC_CSN_ID": 1027863229,
        "encounter_date": "2023-09-25",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 40
      },
      {
        "PAT_ENC_CSN_ID": 1022460205,
        "encounter_date": "2023-08-25",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 40
      },
      {
        "PAT_ENC_CSN_ID": 1020583168,
        "encounter_date": "2023-08-21",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 40
      },
      {
        "PAT_ENC_CSN_ID": 1018439080,
        "encounter_date": "2023-08-03",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 40
      },
      {
        "PAT_ENC_CSN_ID": 1016759309,
        "encounter_date": "2023-07-25",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 40
      },
      {
        "PAT_ENC_CSN_ID": 1011533066,
        "encounter_date": "2023-06-25",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 40
      },
      {
        "PAT_ENC_CSN_ID": 1006342664,
        "encounter_date": "2023-05-25",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM",
        "age_at_encounter": 40
      }
    ],
    "columns": [
      "PAT_ENC_CSN_ID",
      "encounter_date",
      "BIRTH_DATE",
      "age_at_encounter"
    ],
    "error": null
  },
  {
    "id": "02.4-dates-and-times-9",
    "originalQuery": "WITH encounter_sequence AS (\n  SELECT \n    PAT_ID,\n    PAT_ENC_CSN_ID,\n    PAT_ENC_DATE_REAL,\n    LAG(PAT_ENC_DATE_REAL) OVER (\n      PARTITION BY PAT_ID \n      ORDER BY PAT_ENC_DATE_REAL\n    ) as prev_encounter_real\n  FROM pat_enc\n  WHERE PAT_ENC_DATE_REAL IS NOT NULL\n)\nSELECT \n  PAT_ID,\n  PAT_ENC_CSN_ID,\n  DATE('1840-12-31', '+' || CAST(PAT_ENC_DATE_REAL AS INTEGER) || ' days') as encounter_date,\n  ROUND(PAT_ENC_DATE_REAL - prev_encounter_real, 1) as days_since_last_visit\nFROM encounter_sequence\nWHERE prev_encounter_real IS NOT NULL\n  AND PAT_ENC_DATE_REAL - prev_encounter_real > 0\nORDER BY days_since_last_visit DESC\nLIMIT 20",
    "description": "Calculate days between consecutive patient visits",
    "chapterId": "02.4-dates-and-times",
    "index": 9,
    "results": [
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 1028744231,
        "encounter_date": "2024-11-07",
        "days_since_last_visit": 256
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 827277205,
        "encounter_date": "2020-06-29",
        "days_since_last_visit": 172
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 921952141,
        "encounter_date": "2022-02-09",
        "days_since_last_visit": 137
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 736485409,
        "encounter_date": "2018-10-25",
        "days_since_last_visit": 58
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 799951565,
        "encounter_date": "2020-01-09",
        "days_since_last_visit": 45
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 787137346,
        "encounter_date": "2019-09-28",
        "days_since_last_visit": 34
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 740764099,
        "encounter_date": "2018-11-25",
        "days_since_last_visit": 31
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 749745972,
        "encounter_date": "2019-01-25",
        "days_since_last_visit": 31
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 763443168,
        "encounter_date": "2019-04-25",
        "days_since_last_visit": 31
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 772693619,
        "encounter_date": "2019-06-25",
        "days_since_last_visit": 31
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 781842097,
        "encounter_date": "2019-08-25",
        "days_since_last_visit": 31
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 797089043,
        "encounter_date": "2019-11-25",
        "days_since_last_visit": 31
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 850593484,
        "encounter_date": "2020-11-25",
        "days_since_last_visit": 31
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 859392791,
        "encounter_date": "2021-01-25",
        "days_since_last_visit": 31
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 864389217,
        "encounter_date": "2021-02-25",
        "days_since_last_visit": 31
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 873928397,
        "encounter_date": "2021-04-25",
        "days_since_last_visit": 31
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 883637721,
        "encounter_date": "2021-06-25",
        "days_since_last_visit": 31
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 893473416,
        "encounter_date": "2021-08-25",
        "days_since_last_visit": 31
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 898794674,
        "encounter_date": "2021-09-25",
        "days_since_last_visit": 31
      },
      {
        "PAT_ID": "Z7004242",
        "PAT_ENC_CSN_ID": 935515793,
        "encounter_date": "2022-04-25",
        "days_since_last_visit": 31
      }
    ],
    "columns": [
      "PAT_ID",
      "PAT_ENC_CSN_ID",
      "encounter_date",
      "days_since_last_visit"
    ],
    "error": null
  },
  {
    "id": "02.4-dates-and-times-10",
    "originalQuery": "SELECT \n  'HOSP_ADMSN_TIME' as field_name,\n  COUNT(*) as total_records,\n  COUNT(HOSP_ADMSN_TIME) as has_value,\n  COUNT(*) - COUNT(HOSP_ADMSN_TIME) as null_count,\n  ROUND((COUNT(*) - COUNT(HOSP_ADMSN_TIME)) * 100.0 / COUNT(*), 1) as null_percentage\nFROM pat_enc\nUNION ALL\nSELECT \n  'HOSP_DISCHRG_TIME',\n  COUNT(*),\n  COUNT(HOSP_DISCHRG_TIME),\n  COUNT(*) - COUNT(HOSP_DISCHRG_TIME),\n  ROUND((COUNT(*) - COUNT(HOSP_DISCHRG_TIME)) * 100.0 / COUNT(*), 1)\nFROM pat_enc\nUNION ALL\nSELECT \n  'UPDATE_DATE',\n  COUNT(*),\n  COUNT(UPDATE_DATE),\n  COUNT(*) - COUNT(UPDATE_DATE),\n  ROUND((COUNT(*) - COUNT(UPDATE_DATE)) * 100.0 / COUNT(*), 1)\nFROM pat_enc",
    "description": "Analyze missing date patterns",
    "chapterId": "02.4-dates-and-times",
    "index": 10,
    "results": [
      {
        "field_name": "HOSP_ADMSN_TIME",
        "total_records": 111,
        "has_value": 111,
        "null_count": 0,
        "null_percentage": 0
      },
      {
        "field_name": "HOSP_DISCHRG_TIME",
        "total_records": 111,
        "has_value": 111,
        "null_count": 0,
        "null_percentage": 0
      },
      {
        "field_name": "UPDATE_DATE",
        "total_records": 111,
        "has_value": 111,
        "null_count": 0,
        "null_percentage": 0
      }
    ],
    "columns": [
      "field_name",
      "total_records",
      "has_value",
      "null_count",
      "null_percentage"
    ],
    "error": null
  }
]