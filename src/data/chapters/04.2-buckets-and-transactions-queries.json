[
  {
    "id": "04.2-buckets-and-transactions-0",
    "originalQuery": "SELECT \n  HSP_ACCOUNT_ID,\n  TX_TYPE_HA_C_NAME as transaction_type,\n  COUNT(*) as count,\n  SUM(TX_AMOUNT) as total_amount,\n  -- Group transactions by their purpose\n  CASE \n    WHEN TX_TYPE_HA_C_NAME = 'Charge' THEN '1. Original Charges'\n    WHEN TX_TYPE_HA_C_NAME LIKE '%Adjustment' THEN '2. Adjustments'\n    WHEN TX_TYPE_HA_C_NAME = 'Payment' THEN '3. Payments'\n    ELSE '4. Other'\n  END as transaction_category\nFROM HSP_TRANSACTIONS\nGROUP BY HSP_ACCOUNT_ID, TX_TYPE_HA_C_NAME\nORDER BY HSP_ACCOUNT_ID, transaction_category;",
    "description": "View the flow of charges through different transaction types",
    "chapterId": "04.2-buckets-and-transactions",
    "index": 0,
    "results": [
      {
        "HSP_ACCOUNT_ID": 376684810,
        "transaction_type": "Charge",
        "count": 3,
        "total_amount": 1638.8200000000002,
        "transaction_category": "1. Original Charges"
      },
      {
        "HSP_ACCOUNT_ID": 376684810,
        "transaction_type": "Credit Adjustment",
        "count": 3,
        "total_amount": -3155.91,
        "transaction_category": "2. Adjustments"
      },
      {
        "HSP_ACCOUNT_ID": 376684810,
        "transaction_type": "Debit Adjustment",
        "count": 2,
        "total_amount": 2193.09,
        "transaction_category": "2. Adjustments"
      },
      {
        "HSP_ACCOUNT_ID": 376684810,
        "transaction_type": "Payment",
        "count": 2,
        "total_amount": -676,
        "transaction_category": "3. Payments"
      }
    ],
    "columns": [
      "HSP_ACCOUNT_ID",
      "transaction_type",
      "count",
      "total_amount",
      "transaction_category"
    ],
    "error": null
  },
  {
    "id": "04.2-buckets-and-transactions-1",
    "originalQuery": "SELECT \n  HSP_ACCOUNT_ID,\n  TX_ID,\n  TX_TYPE_HA_C_NAME,\n  TX_AMOUNT,\n  BUCKET_ID,\n  SERVICE_DATE,\n  TX_POST_DATE,\n  -- Identify bucket transfers by looking for paired adjustments\n  CASE \n    WHEN TX_TYPE_HA_C_NAME = 'Credit Adjustment' AND TX_AMOUNT < 0 THEN 'Moving FROM this bucket'\n    WHEN TX_TYPE_HA_C_NAME = 'Debit Adjustment' AND TX_AMOUNT > 0 THEN 'Moving TO this bucket'\n    ELSE 'Regular transaction'\n  END as transfer_direction\nFROM HSP_TRANSACTIONS\nWHERE BUCKET_ID IS NOT NULL\nORDER BY HSP_ACCOUNT_ID, TX_POST_DATE, TX_ID;",
    "description": "Trace charge movement between buckets using adjustments",
    "chapterId": "04.2-buckets-and-transactions",
    "index": 1,
    "results": [
      {
        "HSP_ACCOUNT_ID": 376684810,
        "TX_ID": 678816450,
        "TX_TYPE_HA_C_NAME": "Credit Adjustment",
        "TX_AMOUNT": -1638.82,
        "BUCKET_ID": 464352999,
        "SERVICE_DATE": "4/15/2022 12:00:00 AM",
        "TX_POST_DATE": "4/15/2022 12:00:00 AM",
        "transfer_direction": "Moving FROM this bucket"
      },
      {
        "HSP_ACCOUNT_ID": 376684810,
        "TX_ID": 678816451,
        "TX_TYPE_HA_C_NAME": "Debit Adjustment",
        "TX_AMOUNT": 1638.82,
        "BUCKET_ID": 464353002,
        "SERVICE_DATE": "4/15/2022 12:00:00 AM",
        "TX_POST_DATE": "4/15/2022 12:00:00 AM",
        "transfer_direction": "Moving TO this bucket"
      },
      {
        "HSP_ACCOUNT_ID": 376684810,
        "TX_ID": 681354876,
        "TX_TYPE_HA_C_NAME": "Payment",
        "TX_AMOUNT": -121.73,
        "BUCKET_ID": 464353002,
        "SERVICE_DATE": "4/26/2022 12:00:00 AM",
        "TX_POST_DATE": "4/26/2022 12:00:00 AM",
        "transfer_direction": "Regular transaction"
      },
      {
        "HSP_ACCOUNT_ID": 376684810,
        "TX_ID": 681354878,
        "TX_TYPE_HA_C_NAME": "Credit Adjustment",
        "TX_AMOUNT": -962.82,
        "BUCKET_ID": 464353002,
        "SERVICE_DATE": "4/26/2022 12:00:00 AM",
        "TX_POST_DATE": "4/26/2022 12:00:00 AM",
        "transfer_direction": "Moving FROM this bucket"
      },
      {
        "HSP_ACCOUNT_ID": 376684810,
        "TX_ID": 681354880,
        "TX_TYPE_HA_C_NAME": "Debit Adjustment",
        "TX_AMOUNT": 554.27,
        "BUCKET_ID": 464353000,
        "SERVICE_DATE": "4/26/2022 12:00:00 AM",
        "TX_POST_DATE": "4/26/2022 12:00:00 AM",
        "transfer_direction": "Moving TO this bucket"
      },
      {
        "HSP_ACCOUNT_ID": 376684810,
        "TX_ID": 681354883,
        "TX_TYPE_HA_C_NAME": "Credit Adjustment",
        "TX_AMOUNT": -554.27,
        "BUCKET_ID": 464353002,
        "SERVICE_DATE": "4/26/2022 12:00:00 AM",
        "TX_POST_DATE": "4/26/2022 12:00:00 AM",
        "transfer_direction": "Moving FROM this bucket"
      },
      {
        "HSP_ACCOUNT_ID": 376684810,
        "TX_ID": 685171641,
        "TX_TYPE_HA_C_NAME": "Payment",
        "TX_AMOUNT": -554.27,
        "BUCKET_ID": 464353000,
        "SERVICE_DATE": "5/11/2022 12:00:00 AM",
        "TX_POST_DATE": "5/11/2022 12:00:00 AM",
        "transfer_direction": "Regular transaction"
      }
    ],
    "columns": [
      "HSP_ACCOUNT_ID",
      "TX_ID",
      "TX_TYPE_HA_C_NAME",
      "TX_AMOUNT",
      "BUCKET_ID",
      "SERVICE_DATE",
      "TX_POST_DATE",
      "transfer_direction"
    ],
    "error": null
  },
  {
    "id": "04.2-buckets-and-transactions-2",
    "originalQuery": "SELECT \n  TX_TYPE_HA_C_NAME as transaction_type,\n  COUNT(*) as transaction_count,\n  SUM(CASE WHEN TX_AMOUNT > 0 THEN TX_AMOUNT ELSE 0 END) as total_debits,\n  SUM(CASE WHEN TX_AMOUNT < 0 THEN ABS(TX_AMOUNT) ELSE 0 END) as total_credits,\n  SUM(TX_AMOUNT) as net_impact,\n  -- Calculate average transaction size\n  AVG(ABS(TX_AMOUNT)) as avg_transaction_size\nFROM HSP_TRANSACTIONS\nGROUP BY TX_TYPE_HA_C_NAME\nORDER BY transaction_count DESC;",
    "description": "Analyze transaction patterns and their financial impact",
    "chapterId": "04.2-buckets-and-transactions",
    "index": 2,
    "results": [
      {
        "transaction_type": "Credit Adjustment",
        "transaction_count": 3,
        "total_debits": 0,
        "total_credits": 3155.91,
        "net_impact": -3155.91,
        "avg_transaction_size": 1051.97
      },
      {
        "transaction_type": "Charge",
        "transaction_count": 3,
        "total_debits": 1638.8200000000002,
        "total_credits": 0,
        "net_impact": 1638.8200000000002,
        "avg_transaction_size": 546.2733333333334
      },
      {
        "transaction_type": "Payment",
        "transaction_count": 2,
        "total_debits": 0,
        "total_credits": 676,
        "net_impact": -676,
        "avg_transaction_size": 338
      },
      {
        "transaction_type": "Debit Adjustment",
        "transaction_count": 2,
        "total_debits": 2193.09,
        "total_credits": 0,
        "net_impact": 2193.09,
        "avg_transaction_size": 1096.545
      }
    ],
    "columns": [
      "transaction_type",
      "transaction_count",
      "total_debits",
      "total_credits",
      "net_impact",
      "avg_transaction_size"
    ],
    "error": null
  },
  {
    "id": "04.2-buckets-and-transactions-3",
    "originalQuery": "SELECT \n  TX_ID,\n  HSP_ACCOUNT_ID,\n  -- What happened\n  TX_TYPE_HA_C_NAME as transaction_type,\n  TX_AMOUNT as amount,\n  -- When it happened\n  SERVICE_DATE,\n  TX_POST_DATE,\n  CAST(JULIANDAY(TX_POST_DATE) - JULIANDAY(SERVICE_DATE) AS INTEGER) as days_to_post,\n  -- Where (bucket)\n  BUCKET_ID,\n  -- Clinical context\n  UB_REV_CODE_ID as revenue_code,\n  UB_REV_CODE_ID_REVENUE_CODE_NAME as revenue_description,\n  PROC_ID,\n  PROCEDURE_DESC as proc_name,\n  -- Who posted it\n  USER_ID_NAME as posted_by\nFROM HSP_TRANSACTIONS\nWHERE TX_AMOUNT != 0\nORDER BY TX_POST_DATE DESC\nLIMIT 20;",
    "description": "Examine the complete anatomy of hospital transactions",
    "chapterId": "04.2-buckets-and-transactions",
    "index": 3,
    "results": [
      {
        "TX_ID": 685171641,
        "HSP_ACCOUNT_ID": 376684810,
        "transaction_type": "Payment",
        "amount": -554.27,
        "SERVICE_DATE": "5/11/2022 12:00:00 AM",
        "TX_POST_DATE": "5/11/2022 12:00:00 AM",
        "days_to_post": null,
        "BUCKET_ID": 464353000,
        "revenue_code": null,
        "revenue_description": "",
        "PROC_ID": 99974,
        "proc_name": "AVADYNE PAYMENT",
        "posted_by": "GARLAND, ALICIA R"
      },
      {
        "TX_ID": 681354883,
        "HSP_ACCOUNT_ID": 376684810,
        "transaction_type": "Credit Adjustment",
        "amount": -554.27,
        "SERVICE_DATE": "4/26/2022 12:00:00 AM",
        "TX_POST_DATE": "4/26/2022 12:00:00 AM",
        "days_to_post": null,
        "BUCKET_ID": 464353002,
        "revenue_code": null,
        "revenue_description": "",
        "PROC_ID": 34691,
        "proc_name": "SYSTEM CREDIT ADJUSTMENT",
        "posted_by": "AUTO ACCEPT"
      },
      {
        "TX_ID": 681354880,
        "HSP_ACCOUNT_ID": 376684810,
        "transaction_type": "Debit Adjustment",
        "amount": 554.27,
        "SERVICE_DATE": "4/26/2022 12:00:00 AM",
        "TX_POST_DATE": "4/26/2022 12:00:00 AM",
        "days_to_post": null,
        "BUCKET_ID": 464353000,
        "revenue_code": null,
        "revenue_description": "",
        "PROC_ID": 34693,
        "proc_name": "SYSTEM DEBIT ADJUSTMENT",
        "posted_by": "AUTO ACCEPT"
      },
      {
        "TX_ID": 681354878,
        "HSP_ACCOUNT_ID": 376684810,
        "transaction_type": "Credit Adjustment",
        "amount": -962.82,
        "SERVICE_DATE": "4/26/2022 12:00:00 AM",
        "TX_POST_DATE": "4/26/2022 12:00:00 AM",
        "days_to_post": null,
        "BUCKET_ID": 464353002,
        "revenue_code": null,
        "revenue_description": "",
        "PROC_ID": 10226,
        "proc_name": "CONTRACTUAL WRITE-OFF (INSURANCE)",
        "posted_by": "AUTO ACCEPT"
      },
      {
        "TX_ID": 681354876,
        "HSP_ACCOUNT_ID": 376684810,
        "transaction_type": "Payment",
        "amount": -121.73,
        "SERVICE_DATE": "4/26/2022 12:00:00 AM",
        "TX_POST_DATE": "4/26/2022 12:00:00 AM",
        "days_to_post": null,
        "BUCKET_ID": 464353002,
        "revenue_code": null,
        "revenue_description": "",
        "PROC_ID": 104664,
        "proc_name": "EMDEON INSURANCE PAYMENT",
        "posted_by": "AUTO ACCEPT"
      },
      {
        "TX_ID": 678816451,
        "HSP_ACCOUNT_ID": 376684810,
        "transaction_type": "Debit Adjustment",
        "amount": 1638.82,
        "SERVICE_DATE": "4/15/2022 12:00:00 AM",
        "TX_POST_DATE": "4/15/2022 12:00:00 AM",
        "days_to_post": null,
        "BUCKET_ID": 464353002,
        "revenue_code": null,
        "revenue_description": "",
        "PROC_ID": 34693,
        "proc_name": "SYSTEM DEBIT ADJUSTMENT",
        "posted_by": "HB, BACKGROUND"
      },
      {
        "TX_ID": 678816450,
        "HSP_ACCOUNT_ID": 376684810,
        "transaction_type": "Credit Adjustment",
        "amount": -1638.82,
        "SERVICE_DATE": "4/15/2022 12:00:00 AM",
        "TX_POST_DATE": "4/15/2022 12:00:00 AM",
        "days_to_post": null,
        "BUCKET_ID": 464352999,
        "revenue_code": null,
        "revenue_description": "",
        "PROC_ID": 34691,
        "proc_name": "SYSTEM CREDIT ADJUSTMENT",
        "posted_by": "HB, BACKGROUND"
      },
      {
        "TX_ID": 672984063,
        "HSP_ACCOUNT_ID": 376684810,
        "transaction_type": "Charge",
        "amount": 865.08,
        "SERVICE_DATE": "3/22/2022 12:00:00 AM",
        "TX_POST_DATE": "3/22/2022 12:00:00 AM",
        "days_to_post": null,
        "BUCKET_ID": null,
        "revenue_code": 430,
        "revenue_description": "OCCUPATIONAL THERAPY - GENERAL CLASSIFICATION",
        "PROC_ID": 79022,
        "proc_name": "HC ADL/SELF CARE TRN EA 15M",
        "posted_by": "GILMOUR, AARON K"
      },
      {
        "TX_ID": 670514272,
        "HSP_ACCOUNT_ID": 376684810,
        "transaction_type": "Charge",
        "amount": 557.47,
        "SERVICE_DATE": "3/11/2022 12:00:00 AM",
        "TX_POST_DATE": "3/11/2022 12:00:00 AM",
        "days_to_post": null,
        "BUCKET_ID": null,
        "revenue_code": 434,
        "revenue_description": "OCCUPATIONAL THERAPY - EVALUATION OR REEVALUATION",
        "PROC_ID": 87356,
        "proc_name": "HC OT EVAL LOW COMPLEX",
        "posted_by": "GILMOUR, AARON K"
      },
      {
        "TX_ID": 670514271,
        "HSP_ACCOUNT_ID": 376684810,
        "transaction_type": "Charge",
        "amount": 216.27,
        "SERVICE_DATE": "3/11/2022 12:00:00 AM",
        "TX_POST_DATE": "3/11/2022 12:00:00 AM",
        "days_to_post": null,
        "BUCKET_ID": null,
        "revenue_code": 430,
        "revenue_description": "OCCUPATIONAL THERAPY - GENERAL CLASSIFICATION",
        "PROC_ID": 79022,
        "proc_name": "HC ADL/SELF CARE TRN EA 15M",
        "posted_by": "GILMOUR, AARON K"
      }
    ],
    "columns": [
      "TX_ID",
      "HSP_ACCOUNT_ID",
      "transaction_type",
      "amount",
      "SERVICE_DATE",
      "TX_POST_DATE",
      "days_to_post",
      "BUCKET_ID",
      "revenue_code",
      "revenue_description",
      "PROC_ID",
      "proc_name",
      "posted_by"
    ],
    "error": null
  },
  {
    "id": "04.2-buckets-and-transactions-4",
    "originalQuery": "SELECT \n  UB_REV_CODE_ID,\n  UB_REV_CODE_ID_REVENUE_CODE_NAME as service_category,\n  COUNT(*) as service_count,\n  SUM(TX_AMOUNT) as total_charges,\n  AVG(TX_AMOUNT) as average_charge,\n  MIN(SERVICE_DATE) as first_service,\n  MAX(SERVICE_DATE) as last_service\nFROM HSP_TRANSACTIONS\nWHERE TX_TYPE_HA_C_NAME = 'Charge'\n  AND UB_REV_CODE_ID IS NOT NULL\nGROUP BY UB_REV_CODE_ID, UB_REV_CODE_ID_REVENUE_CODE_NAME\nORDER BY total_charges DESC;",
    "description": "Analyze services provided by revenue code",
    "chapterId": "04.2-buckets-and-transactions",
    "index": 4,
    "results": [
      {
        "UB_REV_CODE_ID": 430,
        "service_category": "OCCUPATIONAL THERAPY - GENERAL CLASSIFICATION",
        "service_count": 2,
        "total_charges": 1081.3500000000001,
        "average_charge": 540.6750000000001,
        "first_service": "3/11/2022 12:00:00 AM",
        "last_service": "3/22/2022 12:00:00 AM"
      },
      {
        "UB_REV_CODE_ID": 434,
        "service_category": "OCCUPATIONAL THERAPY - EVALUATION OR REEVALUATION",
        "service_count": 1,
        "total_charges": 557.47,
        "average_charge": 557.47,
        "first_service": "3/11/2022 12:00:00 AM",
        "last_service": "3/11/2022 12:00:00 AM"
      }
    ],
    "columns": [
      "UB_REV_CODE_ID",
      "service_category",
      "service_count",
      "total_charges",
      "average_charge",
      "first_service",
      "last_service"
    ],
    "error": null
  },
  {
    "id": "04.2-buckets-and-transactions-5",
    "originalQuery": "WITH account_summary AS (\n  SELECT \n    HSP_ACCOUNT_ID,\n    -- Charges increase balance (positive)\n    SUM(CASE WHEN TX_TYPE_HA_C_NAME = 'Charge' THEN TX_AMOUNT ELSE 0 END) as total_charges,\n    -- Payments decrease balance (negative amounts)\n    SUM(CASE WHEN TX_TYPE_HA_C_NAME = 'Payment' THEN TX_AMOUNT ELSE 0 END) as total_payments,\n    -- Adjustments can go either way\n    SUM(CASE WHEN TX_TYPE_HA_C_NAME LIKE '%Adjustment' THEN TX_AMOUNT ELSE 0 END) as total_adjustments,\n    -- The final balance\n    SUM(TX_AMOUNT) as calculated_balance,\n    -- Transaction metrics\n    COUNT(*) as transaction_count,\n    MIN(SERVICE_DATE) as first_service,\n    MAX(SERVICE_DATE) as last_service\n  FROM HSP_TRANSACTIONS\n  GROUP BY HSP_ACCOUNT_ID\n)\nSELECT \n  *,\n  -- Calculate collection rate\n  CASE \n    WHEN total_charges > 0 THEN \n      ROUND(ABS(total_payments) / total_charges * 100, 2) \n    ELSE 0 \n  END as collection_rate_pct,\n  -- Days between first and last service\n  CAST(JULIANDAY(last_service) - JULIANDAY(first_service) AS INTEGER) as service_span_days\nFROM account_summary\nORDER BY total_charges DESC;",
    "description": "Calculate account balances from transaction history",
    "chapterId": "04.2-buckets-and-transactions",
    "index": 5,
    "results": [
      {
        "HSP_ACCOUNT_ID": 376684810,
        "total_charges": 1638.8200000000002,
        "total_payments": -676,
        "total_adjustments": -962.82,
        "calculated_balance": 4.263256414560601e-14,
        "transaction_count": 10,
        "first_service": "3/11/2022 12:00:00 AM",
        "last_service": "5/11/2022 12:00:00 AM",
        "collection_rate_pct": 41.25,
        "service_span_days": null
      }
    ],
    "columns": [
      "HSP_ACCOUNT_ID",
      "total_charges",
      "total_payments",
      "total_adjustments",
      "calculated_balance",
      "transaction_count",
      "first_service",
      "last_service",
      "collection_rate_pct",
      "service_span_days"
    ],
    "error": null
  },
  {
    "id": "04.2-buckets-and-transactions-6",
    "originalQuery": "WITH paired_adjustments AS (\n  SELECT \n    t1.HSP_ACCOUNT_ID,\n    t1.TX_ID as credit_tx_id,\n    t1.TX_AMOUNT as credit_amount,\n    t1.BUCKET_ID as from_bucket,\n    t2.TX_ID as debit_tx_id,\n    t2.TX_AMOUNT as debit_amount,\n    t2.BUCKET_ID as to_bucket,\n    t1.TX_POST_DATE\n  FROM HSP_TRANSACTIONS t1\n  JOIN HSP_TRANSACTIONS t2 \n    ON t1.HSP_ACCOUNT_ID = t2.HSP_ACCOUNT_ID\n    AND t1.TX_POST_DATE = t2.TX_POST_DATE\n    AND ABS(t1.TX_AMOUNT) = ABS(t2.TX_AMOUNT)\n    AND t1.TX_AMOUNT < 0  -- Credit adjustment\n    AND t2.TX_AMOUNT > 0  -- Debit adjustment\n    AND t1.TX_TYPE_HA_C_NAME = 'Credit Adjustment'\n    AND t2.TX_TYPE_HA_C_NAME = 'Debit Adjustment'\n)\nSELECT \n  HSP_ACCOUNT_ID,\n  credit_tx_id,\n  debit_tx_id,\n  ABS(credit_amount) as transfer_amount,\n  from_bucket,\n  to_bucket,\n  TX_POST_DATE as transfer_date\nFROM paired_adjustments\nORDER BY TX_POST_DATE;",
    "description": "Identify paired transactions that represent bucket transfers",
    "chapterId": "04.2-buckets-and-transactions",
    "index": 6,
    "results": [
      {
        "HSP_ACCOUNT_ID": 376684810,
        "credit_tx_id": 678816450,
        "debit_tx_id": 678816451,
        "transfer_amount": 1638.82,
        "from_bucket": 464352999,
        "to_bucket": 464353002,
        "transfer_date": "4/15/2022 12:00:00 AM"
      },
      {
        "HSP_ACCOUNT_ID": 376684810,
        "credit_tx_id": 681354883,
        "debit_tx_id": 681354880,
        "transfer_amount": 554.27,
        "from_bucket": 464353002,
        "to_bucket": 464353000,
        "transfer_date": "4/26/2022 12:00:00 AM"
      }
    ],
    "columns": [
      "HSP_ACCOUNT_ID",
      "credit_tx_id",
      "debit_tx_id",
      "transfer_amount",
      "from_bucket",
      "to_bucket",
      "transfer_date"
    ],
    "error": null
  },
  {
    "id": "04.2-buckets-and-transactions-7",
    "originalQuery": "SELECT \n  TX_TYPE_HA_C_NAME,\n  COUNT(*) as adjustment_count,\n  SUM(ABS(TX_AMOUNT)) as total_adjusted,\n  AVG(ABS(TX_AMOUNT)) as avg_adjustment,\n  -- Categorize by amount direction\n  SUM(CASE WHEN TX_AMOUNT < 0 THEN 1 ELSE 0 END) as credit_adjustments,\n  SUM(CASE WHEN TX_AMOUNT > 0 THEN 1 ELSE 0 END) as debit_adjustments,\n  -- Identify the purpose\n  CASE \n    WHEN SUM(CASE WHEN TX_AMOUNT < 0 THEN 1 ELSE 0 END) = \n         SUM(CASE WHEN TX_AMOUNT > 0 THEN 1 ELSE 0 END) \n    THEN 'Likely bucket transfers'\n    WHEN TX_AMOUNT < 0 THEN 'Write-offs or contractual'\n    ELSE 'Charge corrections'\n  END as likely_purpose\nFROM HSP_TRANSACTIONS\nWHERE TX_TYPE_HA_C_NAME LIKE '%Adjustment'\nGROUP BY TX_TYPE_HA_C_NAME\nORDER BY adjustment_count DESC;",
    "description": "Analyze adjustment patterns and their business meaning",
    "chapterId": "04.2-buckets-and-transactions",
    "index": 7,
    "results": [
      {
        "TX_TYPE_HA_C_NAME": "Credit Adjustment",
        "adjustment_count": 3,
        "total_adjusted": 3155.91,
        "avg_adjustment": 1051.97,
        "credit_adjustments": 3,
        "debit_adjustments": 0,
        "likely_purpose": "Write-offs or contractual"
      },
      {
        "TX_TYPE_HA_C_NAME": "Debit Adjustment",
        "adjustment_count": 2,
        "total_adjusted": 2193.09,
        "avg_adjustment": 1096.545,
        "credit_adjustments": 0,
        "debit_adjustments": 2,
        "likely_purpose": "Charge corrections"
      }
    ],
    "columns": [
      "TX_TYPE_HA_C_NAME",
      "adjustment_count",
      "total_adjusted",
      "avg_adjustment",
      "credit_adjustments",
      "debit_adjustments",
      "likely_purpose"
    ],
    "error": null
  },
  {
    "id": "04.2-buckets-and-transactions-8",
    "originalQuery": "SELECT \n  HSP_ACCOUNT_ID,\n  TX_ID,\n  ABS(TX_AMOUNT) as payment_amount,\n  SERVICE_DATE,\n  TX_POST_DATE,\n  CAST(JULIANDAY(TX_POST_DATE) - JULIANDAY(SERVICE_DATE) AS INTEGER) as days_to_payment,\n  BUCKET_ID,\n  -- Identify payment source by amount and timing\n  CASE \n    WHEN CAST(JULIANDAY(TX_POST_DATE) - JULIANDAY(SERVICE_DATE) AS INTEGER) < 30 THEN 'Quick pay'\n    WHEN CAST(JULIANDAY(TX_POST_DATE) - JULIANDAY(SERVICE_DATE) AS INTEGER) < 60 THEN 'Standard pay'\n    WHEN CAST(JULIANDAY(TX_POST_DATE) - JULIANDAY(SERVICE_DATE) AS INTEGER) < 120 THEN 'Slow pay'\n    ELSE 'Very slow pay'\n  END as payment_speed,\n  -- Payment characteristics\n  CASE \n    WHEN ABS(TX_AMOUNT) < 50 THEN 'Small payment (likely copay)'\n    WHEN ABS(TX_AMOUNT) < 500 THEN 'Medium payment'\n    ELSE 'Large payment (likely insurance)'\n  END as payment_type\nFROM HSP_TRANSACTIONS\nWHERE TX_TYPE_HA_C_NAME = 'Payment'\nORDER BY days_to_payment DESC;",
    "description": "Analyze payment patterns and timing",
    "chapterId": "04.2-buckets-and-transactions",
    "index": 8,
    "results": [
      {
        "HSP_ACCOUNT_ID": 376684810,
        "TX_ID": 685171641,
        "payment_amount": 554.27,
        "SERVICE_DATE": "5/11/2022 12:00:00 AM",
        "TX_POST_DATE": "5/11/2022 12:00:00 AM",
        "days_to_payment": null,
        "BUCKET_ID": 464353000,
        "payment_speed": "Very slow pay",
        "payment_type": "Large payment (likely insurance)"
      },
      {
        "HSP_ACCOUNT_ID": 376684810,
        "TX_ID": 681354876,
        "payment_amount": 121.73,
        "SERVICE_DATE": "4/26/2022 12:00:00 AM",
        "TX_POST_DATE": "4/26/2022 12:00:00 AM",
        "days_to_payment": null,
        "BUCKET_ID": 464353002,
        "payment_speed": "Very slow pay",
        "payment_type": "Medium payment"
      }
    ],
    "columns": [
      "HSP_ACCOUNT_ID",
      "TX_ID",
      "payment_amount",
      "SERVICE_DATE",
      "TX_POST_DATE",
      "days_to_payment",
      "BUCKET_ID",
      "payment_speed",
      "payment_type"
    ],
    "error": null
  },
  {
    "id": "04.2-buckets-and-transactions-9",
    "originalQuery": "WITH transaction_timeline AS (\n  SELECT \n    HSP_ACCOUNT_ID,\n    TX_ID,\n    TX_TYPE_HA_C_NAME,\n    TX_AMOUNT,\n    SERVICE_DATE,\n    TX_POST_DATE,\n    BUCKET_ID,\n    -- Create a running balance\n    SUM(TX_AMOUNT) OVER (\n      PARTITION BY HSP_ACCOUNT_ID \n      ORDER BY TX_POST_DATE, TX_ID\n    ) as running_balance,\n    -- Number transactions chronologically\n    ROW_NUMBER() OVER (\n      PARTITION BY HSP_ACCOUNT_ID \n      ORDER BY TX_POST_DATE, TX_ID\n    ) as transaction_sequence\n  FROM HSP_TRANSACTIONS\n)\nSELECT \n  transaction_sequence,\n  TX_TYPE_HA_C_NAME as transaction_type,\n  TX_AMOUNT as amount,\n  running_balance,\n  SERVICE_DATE,\n  TX_POST_DATE,\n  BUCKET_ID,\n  -- Show balance changes\n  CASE \n    WHEN TX_AMOUNT > 0 THEN '↑ Balance increased by $' || TX_AMOUNT\n    WHEN TX_AMOUNT < 0 THEN '↓ Balance decreased by $' || ABS(TX_AMOUNT)\n    ELSE '→ No balance change'\n  END as balance_impact\nFROM transaction_timeline\nWHERE HSP_ACCOUNT_ID = '376684810'\nORDER BY transaction_sequence;",
    "description": "Trace the complete lifecycle of charges through modifications",
    "chapterId": "04.2-buckets-and-transactions",
    "index": 9,
    "results": [
      {
        "transaction_sequence": 1,
        "transaction_type": "Charge",
        "amount": 216.27,
        "running_balance": 216.27,
        "SERVICE_DATE": "3/11/2022 12:00:00 AM",
        "TX_POST_DATE": "3/11/2022 12:00:00 AM",
        "BUCKET_ID": null,
        "balance_impact": "↑ Balance increased by $216.27"
      },
      {
        "transaction_sequence": 2,
        "transaction_type": "Charge",
        "amount": 557.47,
        "running_balance": 773.74,
        "SERVICE_DATE": "3/11/2022 12:00:00 AM",
        "TX_POST_DATE": "3/11/2022 12:00:00 AM",
        "BUCKET_ID": null,
        "balance_impact": "↑ Balance increased by $557.47"
      },
      {
        "transaction_sequence": 3,
        "transaction_type": "Charge",
        "amount": 865.08,
        "running_balance": 1638.8200000000002,
        "SERVICE_DATE": "3/22/2022 12:00:00 AM",
        "TX_POST_DATE": "3/22/2022 12:00:00 AM",
        "BUCKET_ID": null,
        "balance_impact": "↑ Balance increased by $865.08"
      },
      {
        "transaction_sequence": 4,
        "transaction_type": "Credit Adjustment",
        "amount": -1638.82,
        "running_balance": 1.4210854715202004e-13,
        "SERVICE_DATE": "4/15/2022 12:00:00 AM",
        "TX_POST_DATE": "4/15/2022 12:00:00 AM",
        "BUCKET_ID": 464352999,
        "balance_impact": "↓ Balance decreased by $1638.82"
      },
      {
        "transaction_sequence": 5,
        "transaction_type": "Debit Adjustment",
        "amount": 1638.82,
        "running_balance": 1638.8200000000002,
        "SERVICE_DATE": "4/15/2022 12:00:00 AM",
        "TX_POST_DATE": "4/15/2022 12:00:00 AM",
        "BUCKET_ID": 464353002,
        "balance_impact": "↑ Balance increased by $1638.82"
      },
      {
        "transaction_sequence": 6,
        "transaction_type": "Payment",
        "amount": -121.73,
        "running_balance": 1517.0900000000001,
        "SERVICE_DATE": "4/26/2022 12:00:00 AM",
        "TX_POST_DATE": "4/26/2022 12:00:00 AM",
        "BUCKET_ID": 464353002,
        "balance_impact": "↓ Balance decreased by $121.73"
      },
      {
        "transaction_sequence": 7,
        "transaction_type": "Credit Adjustment",
        "amount": -962.82,
        "running_balance": 554.27,
        "SERVICE_DATE": "4/26/2022 12:00:00 AM",
        "TX_POST_DATE": "4/26/2022 12:00:00 AM",
        "BUCKET_ID": 464353002,
        "balance_impact": "↓ Balance decreased by $962.82"
      },
      {
        "transaction_sequence": 8,
        "transaction_type": "Debit Adjustment",
        "amount": 554.27,
        "running_balance": 1108.54,
        "SERVICE_DATE": "4/26/2022 12:00:00 AM",
        "TX_POST_DATE": "4/26/2022 12:00:00 AM",
        "BUCKET_ID": 464353000,
        "balance_impact": "↑ Balance increased by $554.27"
      },
      {
        "transaction_sequence": 9,
        "transaction_type": "Credit Adjustment",
        "amount": -554.27,
        "running_balance": 554.27,
        "SERVICE_DATE": "4/26/2022 12:00:00 AM",
        "TX_POST_DATE": "4/26/2022 12:00:00 AM",
        "BUCKET_ID": 464353002,
        "balance_impact": "↓ Balance decreased by $554.27"
      },
      {
        "transaction_sequence": 10,
        "transaction_type": "Payment",
        "amount": -554.27,
        "running_balance": 4.263256414560601e-14,
        "SERVICE_DATE": "5/11/2022 12:00:00 AM",
        "TX_POST_DATE": "5/11/2022 12:00:00 AM",
        "BUCKET_ID": 464353000,
        "balance_impact": "↓ Balance decreased by $554.27"
      }
    ],
    "columns": [
      "transaction_sequence",
      "transaction_type",
      "amount",
      "running_balance",
      "SERVICE_DATE",
      "TX_POST_DATE",
      "BUCKET_ID",
      "balance_impact"
    ],
    "error": null
  },
  {
    "id": "04.2-buckets-and-transactions-10",
    "originalQuery": "WITH account_totals AS (\n  SELECT \n    HSP_ACCOUNT_ID,\n    TOT_CHGS as account_total_charges,\n    TOT_ADJ as account_total_adjustments\n  FROM HSP_ACCOUNT\n),\ntransaction_totals AS (\n  SELECT \n    HSP_ACCOUNT_ID,\n    SUM(CASE WHEN TX_TYPE_HA_C_NAME = 'Charge' THEN TX_AMOUNT ELSE 0 END) as calc_total_charges,\n    SUM(CASE WHEN TX_TYPE_HA_C_NAME LIKE '%Adjustment' THEN TX_AMOUNT ELSE 0 END) as calc_total_adjustments,\n    SUM(CASE WHEN TX_TYPE_HA_C_NAME = 'Payment' THEN TX_AMOUNT ELSE 0 END) as calc_total_payments,\n    SUM(TX_AMOUNT) as calc_balance\n  FROM HSP_TRANSACTIONS\n  GROUP BY HSP_ACCOUNT_ID\n)\nSELECT \n  a.HSP_ACCOUNT_ID,\n  a.account_total_charges,\n  t.calc_total_charges,\n  a.account_total_charges - t.calc_total_charges as charge_variance,\n  a.account_total_adjustments,\n  t.calc_total_adjustments,\n  t.calc_total_payments,\n  t.calc_balance as calculated_balance\nFROM account_totals a\nJOIN transaction_totals t ON a.HSP_ACCOUNT_ID = t.HSP_ACCOUNT_ID;",
    "description": "Validate account totals against transaction details",
    "chapterId": "04.2-buckets-and-transactions",
    "index": 10,
    "results": [
      {
        "HSP_ACCOUNT_ID": 376684810,
        "account_total_charges": 1638.82,
        "calc_total_charges": 1638.8200000000002,
        "charge_variance": -2.2737367544323206e-13,
        "account_total_adjustments": -962.82,
        "calc_total_adjustments": -962.82,
        "calc_total_payments": -676,
        "calculated_balance": 4.263256414560601e-14
      }
    ],
    "columns": [
      "HSP_ACCOUNT_ID",
      "account_total_charges",
      "calc_total_charges",
      "charge_variance",
      "account_total_adjustments",
      "calc_total_adjustments",
      "calc_total_payments",
      "calculated_balance"
    ],
    "error": null
  }
]