[
  {
    "id": "01.2-anatomy-of-ehi-export-0",
    "originalQuery": "-- In a real export, these would be TSV files\n-- Our sample has 550 tables loaded into SQLite\nSELECT COUNT(*) as total_tables \nFROM sqlite_master \nWHERE type='table';",
    "description": "Count the tables in our sample database",
    "chapterId": "01.2-anatomy-of-ehi-export",
    "index": 0,
    "results": [
      {
        "total_tables": 551
      }
    ],
    "columns": [
      "total_tables"
    ],
    "error": null
  },
  {
    "id": "01.2-anatomy-of-ehi-export-1",
    "originalQuery": "-- Look at patient names and addresses - commas everywhere!\nSELECT \n    PAT_NAME,\n    CITY || ', ' || STATE_C_NAME as location\nFROM PATIENT\nWHERE PAT_NAME LIKE '%,%'\nLIMIT 5;",
    "description": "See why commas are problematic in healthcare data",
    "chapterId": "01.2-anatomy-of-ehi-export",
    "index": 1,
    "results": [
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "location": "MADISON, Wisconsin"
      }
    ],
    "columns": [
      "PAT_NAME",
      "location"
    ],
    "error": null
  },
  {
    "id": "01.2-anatomy-of-ehi-export-2",
    "originalQuery": "-- Count tables by their prefix to see module organization\nSELECT \n    CASE \n        WHEN name LIKE 'PAT_%' THEN 'PAT_ (Patient)'\n        WHEN name LIKE 'HSP_%' THEN 'HSP_ (Hospital Billing)'  \n        WHEN name LIKE 'ARPB_%' THEN 'ARPB_ (Professional Billing)'\n        WHEN name LIKE 'ORDER_%' THEN 'ORDER_ (Clinical Orders)'\n        WHEN name LIKE 'CLARITY_%' THEN 'CLARITY_ (Reference Data)'\n        WHEN name LIKE 'ZC_%' THEN 'ZC_ (Category Values)'\n        WHEN name LIKE '%_HX' THEN '*_HX (History Tables)'\n        ELSE 'Other'\n    END as table_type,\n    COUNT(*) as table_count\nFROM sqlite_master \nWHERE type = 'table'\nGROUP BY table_type\nORDER BY table_count DESC;",
    "description": "Explore table naming patterns by prefix",
    "chapterId": "01.2-anatomy-of-ehi-export",
    "index": 2,
    "results": [
      {
        "table_type": "Other",
        "table_count": 312
      },
      {
        "table_type": "PAT_ (Patient)",
        "table_count": 82
      },
      {
        "table_type": "HSP_ (Hospital Billing)",
        "table_count": 52
      },
      {
        "table_type": "ORDER_ (Clinical Orders)",
        "table_count": 48
      },
      {
        "table_type": "CLARITY_ (Reference Data)",
        "table_count": 28
      },
      {
        "table_type": "ARPB_ (Professional Billing)",
        "table_count": 15
      },
      {
        "table_type": "*_HX (History Tables)",
        "table_count": 14
      }
    ],
    "columns": [
      "table_type",
      "table_count"
    ],
    "error": null
  },
  {
    "id": "01.2-anatomy-of-ehi-export-3",
    "originalQuery": "-- History tables track changes over time\nSELECT name as history_table\nFROM sqlite_master\nWHERE type = 'table' \n  AND name LIKE '%_HX'\nORDER BY name\nLIMIT 10;",
    "description": "Find all history tables in the database",
    "chapterId": "01.2-anatomy-of-ehi-export",
    "index": 3,
    "results": [
      {
        "history_table": "ACCT_HOME_PHONE_HX"
      },
      {
        "history_table": "ARPB_TX_CHG_REV_HX"
      },
      {
        "history_table": "ARPB_TX_MATCH_HX"
      },
      {
        "history_table": "ARPB_TX_STMCLAIMHX"
      },
      {
        "history_table": "FAMILY_HX"
      },
      {
        "history_table": "FRONT_END_PMT_COLL_HX"
      },
      {
        "history_table": "GUAR_ACCT_STMT_HX"
      },
      {
        "history_table": "GUAR_ADDR_HX"
      },
      {
        "history_table": "GUAR_PMT_SCORE_PB_HX"
      },
      {
        "history_table": "HSP_BKT_NAA_ADJ_HX"
      }
    ],
    "columns": [
      "history_table"
    ],
    "error": null
  },
  {
    "id": "01.2-anatomy-of-ehi-export-4",
    "originalQuery": "-- Get the description for the CLARITY_DEP table\nSELECT documentation\nFROM _metadata\nWHERE table_name = 'CLARITY_DEP' AND column_name IS NULL;",
    "description": "View documentation for the department table",
    "chapterId": "01.2-anatomy-of-ehi-export",
    "index": 4,
    "results": [
      {
        "documentation": "The CLARITY_DEP table contains high-level information about departments."
      }
    ],
    "columns": [
      "documentation"
    ],
    "error": null
  },
  {
    "id": "01.2-anatomy-of-ehi-export-5",
    "originalQuery": "-- Get descriptions for specific columns\nSELECT column_name, documentation\nFROM _metadata\nWHERE table_name = 'CLARITY_DEP' \n  AND column_name IN ('DEPARTMENT_ID', 'DEPARTMENT_NAME', 'SPECIALTY_C_NAME');",
    "description": "View documentation for key columns in CLARITY_DEP",
    "chapterId": "01.2-anatomy-of-ehi-export",
    "index": 5,
    "results": [
      {
        "column_name": "DEPARTMENT_ID",
        "documentation": "The unique ID number assigned to the department record."
      },
      {
        "column_name": "DEPARTMENT_NAME",
        "documentation": "The name of the department."
      }
    ],
    "columns": [
      "column_name",
      "documentation"
    ],
    "error": null
  },
  {
    "id": "01.2-anatomy-of-ehi-export-6",
    "originalQuery": "-- See which types of tables have the most data\n-- Using PAT_ENC as a proxy for encounter volume\nSELECT \n    'Core Patient Data' as category,\n    COUNT(*) as row_count\nFROM PATIENT\nUNION ALL\nSELECT \n    'Patient Encounters',\n    COUNT(*) \nFROM PAT_ENC\nUNION ALL\nSELECT \n    'Professional Billing',\n    COUNT(*)\nFROM ARPB_TRANSACTIONS\nUNION ALL\nSELECT \n    'Reference Data (Departments)',\n    COUNT(*)\nFROM CLARITY_DEP;",
    "description": "Analyze data distribution across table types",
    "chapterId": "01.2-anatomy-of-ehi-export",
    "index": 6,
    "results": [
      {
        "category": "Core Patient Data",
        "row_count": 1
      },
      {
        "category": "Patient Encounters",
        "row_count": 111
      },
      {
        "category": "Professional Billing",
        "row_count": 52
      },
      {
        "category": "Reference Data (Departments)",
        "row_count": 14
      }
    ],
    "columns": [
      "category",
      "row_count"
    ],
    "error": null
  },
  {
    "id": "01.2-anatomy-of-ehi-export-7",
    "originalQuery": "-- Check that core tables exist and have data\nSELECT \n    'PATIENT' as table_name,\n    CASE WHEN COUNT(*) > 0 THEN 'OK (' || COUNT(*) || ' rows)' \n         ELSE 'EMPTY' END as status\nFROM PATIENT\nUNION ALL\nSELECT \n    'PAT_ENC',\n    CASE WHEN COUNT(*) > 0 THEN 'OK (' || COUNT(*) || ' rows)' \n         ELSE 'EMPTY' END\nFROM PAT_ENC\nUNION ALL\nSELECT \n    'CLARITY_DEP',\n    CASE WHEN COUNT(*) > 0 THEN 'OK (' || COUNT(*) || ' rows)' \n         ELSE 'EMPTY' END\nFROM CLARITY_DEP;",
    "description": "Run a basic health check on the data",
    "chapterId": "01.2-anatomy-of-ehi-export",
    "index": 7,
    "results": [
      {
        "table_name": "PATIENT",
        "status": "OK (1 rows)"
      },
      {
        "table_name": "PAT_ENC",
        "status": "OK (111 rows)"
      },
      {
        "table_name": "CLARITY_DEP",
        "status": "OK (14 rows)"
      }
    ],
    "columns": [
      "table_name",
      "status"
    ],
    "error": null
  }
]