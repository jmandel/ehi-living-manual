[
  {
    "id": "02.2-the-identifier-trinity-0",
    "originalQuery": "SELECT \n  p.PAT_ID as who_patient,\n  pe.PAT_ENC_CSN_ID as what_encounter,\n  pe.HSP_ACCOUNT_ID as why_billing\nFROM PATIENT p\nJOIN PAT_ENC pe ON p.PAT_ID = pe.PAT_ID\nWHERE pe.HSP_ACCOUNT_ID IS NOT NULL\nLIMIT 5;",
    "description": "See the trinity in action",
    "chapterId": "02.2-the-identifier-trinity",
    "index": 0,
    "results": [
      {
        "who_patient": "Z7004242",
        "what_encounter": 922942674,
        "why_billing": 376684810
      },
      {
        "who_patient": "Z7004242",
        "what_encounter": 922943112,
        "why_billing": 376684810
      }
    ],
    "columns": [
      "who_patient",
      "what_encounter",
      "why_billing"
    ],
    "error": null
  },
  {
    "id": "02.2-the-identifier-trinity-1",
    "originalQuery": "SELECT \n  PAT_ID,\n  PAT_NAME,\n  BIRTH_DATE\nFROM PATIENT\nWHERE PAT_ID = 'Z7004242';",
    "description": "Explore patient identity",
    "chapterId": "02.2-the-identifier-trinity",
    "index": 1,
    "results": [
      {
        "PAT_ID": "Z7004242",
        "PAT_NAME": "MANDEL,JOSHUA C",
        "BIRTH_DATE": "10/26/1982 12:00:00 AM"
      }
    ],
    "columns": [
      "PAT_ID",
      "PAT_NAME",
      "BIRTH_DATE"
    ],
    "error": null
  },
  {
    "id": "02.2-the-identifier-trinity-2",
    "originalQuery": "SELECT \n  COUNT(*) as tables_with_pat_id\nFROM _metadata\nWHERE column_name = 'PAT_ID';",
    "description": "Count tables that link directly to PATIENT",
    "chapterId": "02.2-the-identifier-trinity",
    "index": 2,
    "results": [
      {
        "tables_with_pat_id": 82
      }
    ],
    "columns": [
      "tables_with_pat_id"
    ],
    "error": null
  },
  {
    "id": "02.2-the-identifier-trinity-3",
    "originalQuery": "SELECT \n  PAT_ID,\n  COUNT(DISTINCT PAT_ENC_CSN_ID) as total_encounters,\n  MIN(CONTACT_DATE) as first_visit,\n  MAX(CONTACT_DATE) as last_visit\nFROM PAT_ENC\nWHERE PAT_ID = 'Z7004242'\nGROUP BY PAT_ID;",
    "description": "One patient, many encounters",
    "chapterId": "02.2-the-identifier-trinity",
    "index": 3,
    "results": [
      {
        "PAT_ID": "Z7004242",
        "total_encounters": 111,
        "first_visit": "1/25/2019 12:00:00 AM",
        "last_visit": "9/8/2020 12:00:00 AM"
      }
    ],
    "columns": [
      "PAT_ID",
      "total_encounters",
      "first_visit",
      "last_visit"
    ],
    "error": null
  },
  {
    "id": "02.2-the-identifier-trinity-4",
    "originalQuery": "SELECT \n  'Encounter Info' as data_type,\n  COUNT(*) as records\nFROM PAT_ENC \nWHERE PAT_ENC_CSN_ID = '720803470'\nUNION ALL\nSELECT 'Diagnoses', COUNT(*)\nFROM PAT_ENC_DX\nWHERE PAT_ENC_CSN_ID = '720803470'\nUNION ALL\nSELECT 'Orders', COUNT(*)\nFROM ORDER_PROC\nWHERE PAT_ENC_CSN_ID = '720803470';",
    "description": "Everything linked to one encounter",
    "chapterId": "02.2-the-identifier-trinity",
    "index": 4,
    "results": [
      {
        "data_type": "Encounter Info",
        "records": 1
      },
      {
        "data_type": "Diagnoses",
        "records": 3
      },
      {
        "data_type": "Orders",
        "records": 2
      }
    ],
    "columns": [
      "data_type",
      "records"
    ],
    "error": null
  },
  {
    "id": "02.2-the-identifier-trinity-5",
    "originalQuery": "SELECT \n  HSP_ACCOUNT_ID,\n  COUNT(*) as encounters_in_har,\n  MIN(CONTACT_DATE) as first_encounter,\n  MAX(CONTACT_DATE) as last_encounter\nFROM PAT_ENC\nWHERE HSP_ACCOUNT_ID IS NOT NULL\nGROUP BY HSP_ACCOUNT_ID\nHAVING COUNT(*) > 1;",
    "description": "HARs group multiple encounters",
    "chapterId": "02.2-the-identifier-trinity",
    "index": 5,
    "results": [
      {
        "HSP_ACCOUNT_ID": 376684810,
        "encounters_in_har": 2,
        "first_encounter": "3/11/2022 12:00:00 AM",
        "last_encounter": "3/22/2022 12:00:00 AM"
      }
    ],
    "columns": [
      "HSP_ACCOUNT_ID",
      "encounters_in_har",
      "first_encounter",
      "last_encounter"
    ],
    "error": null
  },
  {
    "id": "02.2-the-identifier-trinity-6",
    "originalQuery": "SELECT \n  ha.HSP_ACCOUNT_ID,\n  ha.TOT_CHGS as total_charges,\n  -- Note: Total payments would need to be calculated from HSP_TRANSACTIONS\n  ha.TOT_CHGS - ha.TOT_ADJ as net_charges,\n  ha.ACCT_BILLSTS_HA_C_NAME as billing_status\nFROM HSP_ACCOUNT ha\nWHERE ha.HSP_ACCOUNT_ID = '376684810';",
    "description": "Financial view of a HAR",
    "chapterId": "02.2-the-identifier-trinity",
    "index": 6,
    "results": [
      {
        "HSP_ACCOUNT_ID": 376684810,
        "total_charges": 1638.82,
        "net_charges": 2601.64,
        "billing_status": "Closed"
      }
    ],
    "columns": [
      "HSP_ACCOUNT_ID",
      "total_charges",
      "net_charges",
      "billing_status"
    ],
    "error": null
  },
  {
    "id": "02.2-the-identifier-trinity-7",
    "originalQuery": "SELECT \n  -- Patient info\n  p.PAT_NAME,\n  -- Encounter details\n  pe.PAT_ENC_CSN_ID,\n  pe.CONTACT_DATE,\n  pe.DEPARTMENT_ID,\n  -- Financial linkage\n  pe.HSP_ACCOUNT_ID,\n  -- Clinical data (diagnosis)\n  dx.DX_ID,\n  dx.LINE as diagnosis_priority\nFROM PATIENT p\nJOIN PAT_ENC pe ON p.PAT_ID = pe.PAT_ID\nLEFT JOIN PAT_ENC_DX dx ON pe.PAT_ENC_CSN_ID = dx.PAT_ENC_CSN_ID\nWHERE p.PAT_ID = 'Z7004242'\n  AND pe.CONTACT_DATE >= '2019-01-01'\nORDER BY pe.CONTACT_DATE, dx.LINE\nLIMIT 20;",
    "description": "Complete patient journey",
    "chapterId": "02.2-the-identifier-trinity",
    "index": 7,
    "results": [
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 922942674,
        "CONTACT_DATE": "3/11/2022 12:00:00 AM",
        "DEPARTMENT_ID": 101401044,
        "HSP_ACCOUNT_ID": 376684810,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 927098738,
        "CONTACT_DATE": "3/11/2022 12:00:00 AM",
        "DEPARTMENT_ID": 8,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 927200229,
        "CONTACT_DATE": "3/11/2022 12:00:00 AM",
        "DEPARTMENT_ID": null,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 991215738,
        "CONTACT_DATE": "3/2/2023 12:00:00 AM",
        "DEPARTMENT_ID": null,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 991221485,
        "CONTACT_DATE": "3/2/2023 12:00:00 AM",
        "DEPARTMENT_ID": 1700801002,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 958148810,
        "CONTACT_DATE": "3/2/2023 12:00:00 AM",
        "DEPARTMENT_ID": 1700801002,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": 260690,
        "diagnosis_priority": 1
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 922943112,
        "CONTACT_DATE": "3/22/2022 12:00:00 AM",
        "DEPARTMENT_ID": 101401044,
        "HSP_ACCOUNT_ID": 376684810,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 928532643,
        "CONTACT_DATE": "3/22/2022 12:00:00 AM",
        "DEPARTMENT_ID": null,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 758599939,
        "CONTACT_DATE": "3/25/2019 12:00:00 AM",
        "DEPARTMENT_ID": null,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 869002878,
        "CONTACT_DATE": "3/25/2021 12:00:00 AM",
        "DEPARTMENT_ID": null,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 930010268,
        "CONTACT_DATE": "3/25/2022 12:00:00 AM",
        "DEPARTMENT_ID": null,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 995315871,
        "CONTACT_DATE": "3/25/2023 12:00:00 AM",
        "DEPARTMENT_ID": null,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 996534320,
        "CONTACT_DATE": "3/31/2023 12:00:00 AM",
        "DEPARTMENT_ID": 1700801002,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 763443168,
        "CONTACT_DATE": "4/25/2019 12:00:00 AM",
        "DEPARTMENT_ID": null,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 873928397,
        "CONTACT_DATE": "4/25/2021 12:00:00 AM",
        "DEPARTMENT_ID": null,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 935515793,
        "CONTACT_DATE": "4/25/2022 12:00:00 AM",
        "DEPARTMENT_ID": null,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 1000825434,
        "CONTACT_DATE": "4/25/2023 12:00:00 AM",
        "DEPARTMENT_ID": null,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 768007053,
        "CONTACT_DATE": "5/25/2019 12:00:00 AM",
        "DEPARTMENT_ID": null,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 878774242,
        "CONTACT_DATE": "5/25/2021 12:00:00 AM",
        "DEPARTMENT_ID": null,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      },
      {
        "PAT_NAME": "MANDEL,JOSHUA C",
        "PAT_ENC_CSN_ID": 940919045,
        "CONTACT_DATE": "5/25/2022 12:00:00 AM",
        "DEPARTMENT_ID": null,
        "HSP_ACCOUNT_ID": null,
        "DX_ID": null,
        "diagnosis_priority": null
      }
    ],
    "columns": [
      "PAT_NAME",
      "PAT_ENC_CSN_ID",
      "CONTACT_DATE",
      "DEPARTMENT_ID",
      "HSP_ACCOUNT_ID",
      "DX_ID",
      "diagnosis_priority"
    ],
    "error": null
  },
  {
    "id": "02.2-the-identifier-trinity-8",
    "originalQuery": "SELECT \n  pe.PAT_ENC_CSN_ID,\n  pe.CONTACT_DATE,\n  COUNT(DISTINCT ord.ORDER_PROC_ID) as orders_placed,\n  COUNT(DISTINCT dx.LINE) as diagnoses_recorded\nFROM PAT_ENC pe\nLEFT JOIN ORDER_PROC ord ON pe.PAT_ENC_CSN_ID = ord.PAT_ENC_CSN_ID\nLEFT JOIN PAT_ENC_DX dx ON pe.PAT_ENC_CSN_ID = dx.PAT_ENC_CSN_ID\nWHERE pe.PAT_ID = 'Z7004242'\nGROUP BY pe.PAT_ENC_CSN_ID, pe.CONTACT_DATE\nORDER BY pe.CONTACT_DATE DESC\nLIMIT 10;",
    "description": "Clinical data via CSN",
    "chapterId": "02.2-the-identifier-trinity",
    "index": 8,
    "results": [
      {
        "PAT_ENC_CSN_ID": 837844366,
        "CONTACT_DATE": "9/8/2020 12:00:00 AM",
        "orders_placed": 0,
        "diagnoses_recorded": 0
      },
      {
        "PAT_ENC_CSN_ID": 991225117,
        "CONTACT_DATE": "9/28/2023 12:00:00 AM",
        "orders_placed": 3,
        "diagnoses_recorded": 4
      },
      {
        "PAT_ENC_CSN_ID": 1028739468,
        "CONTACT_DATE": "9/28/2023 12:00:00 AM",
        "orders_placed": 0,
        "diagnoses_recorded": 0
      },
      {
        "PAT_ENC_CSN_ID": 1028743701,
        "CONTACT_DATE": "9/28/2023 12:00:00 AM",
        "orders_placed": 3,
        "diagnoses_recorded": 3
      },
      {
        "PAT_ENC_CSN_ID": 1028766353,
        "CONTACT_DATE": "9/28/2023 12:00:00 AM",
        "orders_placed": 0,
        "diagnoses_recorded": 0
      },
      {
        "PAT_ENC_CSN_ID": 787137346,
        "CONTACT_DATE": "9/28/2019 12:00:00 AM",
        "orders_placed": 0,
        "diagnoses_recorded": 0
      },
      {
        "PAT_ENC_CSN_ID": 1028606559,
        "CONTACT_DATE": "9/27/2023 12:00:00 AM",
        "orders_placed": 0,
        "diagnoses_recorded": 0
      },
      {
        "PAT_ENC_CSN_ID": 1027863229,
        "CONTACT_DATE": "9/25/2023 12:00:00 AM",
        "orders_placed": 0,
        "diagnoses_recorded": 0
      },
      {
        "PAT_ENC_CSN_ID": 962603110,
        "CONTACT_DATE": "9/25/2022 12:00:00 AM",
        "orders_placed": 0,
        "diagnoses_recorded": 0
      },
      {
        "PAT_ENC_CSN_ID": 898794674,
        "CONTACT_DATE": "9/25/2021 12:00:00 AM",
        "orders_placed": 0,
        "diagnoses_recorded": 0
      }
    ],
    "columns": [
      "PAT_ENC_CSN_ID",
      "CONTACT_DATE",
      "orders_placed",
      "diagnoses_recorded"
    ],
    "error": null
  },
  {
    "id": "02.2-the-identifier-trinity-9",
    "originalQuery": "SELECT \n  ha.HSP_ACCOUNT_ID,\n  ha.ACCT_BILLSTS_HA_C_NAME as status,\n  ha.TOT_CHGS as charges,\n  ha.TOT_ADJ as adjustments,\n  ha.TOT_CHGS - ha.TOT_ADJ as net_charges\nFROM HSP_ACCOUNT ha\nWHERE ha.ACCT_BILLSTS_HA_C_NAME != 'Unbilled'\nORDER BY ha.TOT_CHGS DESC\nLIMIT 5;",
    "description": "Financial data via HAR",
    "chapterId": "02.2-the-identifier-trinity",
    "index": 9,
    "results": [
      {
        "HSP_ACCOUNT_ID": 376684810,
        "status": "Closed",
        "charges": 1638.82,
        "adjustments": -962.82,
        "net_charges": 2601.64
      },
      {
        "HSP_ACCOUNT_ID": 377811219,
        "status": "Closed",
        "charges": null,
        "adjustments": null,
        "net_charges": null
      },
      {
        "HSP_ACCOUNT_ID": 376684703,
        "status": "Billed",
        "charges": null,
        "adjustments": null,
        "net_charges": null
      },
      {
        "HSP_ACCOUNT_ID": 377515141,
        "status": "Closed",
        "charges": null,
        "adjustments": null,
        "net_charges": null
      }
    ],
    "columns": [
      "HSP_ACCOUNT_ID",
      "status",
      "charges",
      "adjustments",
      "net_charges"
    ],
    "error": null
  },
  {
    "id": "02.2-the-identifier-trinity-10",
    "originalQuery": "SELECT \n  -- WHO\n  p.PAT_ID,\n  p.PAT_NAME,\n  -- WHAT  \n  pe.PAT_ENC_CSN_ID,\n  pe.CONTACT_DATE,\n  edg.DX_NAME as primary_diagnosis,\n  -- WHY\n  ha.HSP_ACCOUNT_ID,\n  ha.TOT_CHGS as total_charges\nFROM PATIENT p\nJOIN PAT_ENC pe ON p.PAT_ID = pe.PAT_ID\nLEFT JOIN PAT_ENC_DX dx ON pe.PAT_ENC_CSN_ID = dx.PAT_ENC_CSN_ID \n  AND dx.LINE = 1 -- Primary diagnosis only\nLEFT JOIN CLARITY_EDG edg ON dx.DX_ID = edg.DX_ID\nLEFT JOIN HSP_ACCOUNT ha ON pe.HSP_ACCOUNT_ID = ha.HSP_ACCOUNT_ID\nWHERE pe.CONTACT_DATE BETWEEN '2020-01-01' AND '2020-12-31'\n  AND ha.HSP_ACCOUNT_ID IS NOT NULL\nORDER BY pe.CONTACT_DATE\nLIMIT 10;",
    "description": "Complete view using all three identifiers",
    "chapterId": "02.2-the-identifier-trinity",
    "index": 10,
    "results": [],
    "columns": [],
    "error": null
  },
  {
    "id": "02.2-the-identifier-trinity-11",
    "originalQuery": "SELECT \n  COUNT(*) as total_encounters,\n  SUM(CASE WHEN HSP_ACCOUNT_ID IS NULL THEN 1 ELSE 0 END) as no_har,\n  ROUND(100.0 * SUM(CASE WHEN HSP_ACCOUNT_ID IS NULL THEN 1 ELSE 0 END) / COUNT(*), 1) as pct_no_har\nFROM PAT_ENC\nWHERE PAT_ID = 'Z7004242';",
    "description": "Encounters without financial data",
    "chapterId": "02.2-the-identifier-trinity",
    "index": 11,
    "results": [
      {
        "total_encounters": 111,
        "no_har": 109,
        "pct_no_har": 98.2
      }
    ],
    "columns": [
      "total_encounters",
      "no_har",
      "pct_no_har"
    ],
    "error": null
  },
  {
    "id": "02.2-the-identifier-trinity-12",
    "originalQuery": "-- Encounters without patients (should be 0)\nSELECT COUNT(*) as orphan_encounters\nFROM PAT_ENC pe\nLEFT JOIN PATIENT p ON pe.PAT_ID = p.PAT_ID\nWHERE p.PAT_ID IS NULL;",
    "description": "Check data integrity",
    "chapterId": "02.2-the-identifier-trinity",
    "index": 12,
    "results": [
      {
        "orphan_encounters": 0
      }
    ],
    "columns": [
      "orphan_encounters"
    ],
    "error": null
  },
  {
    "id": "02.2-the-identifier-trinity-13",
    "originalQuery": "-- Each encounter should link to at most one HAR\nSELECT \n  PAT_ENC_CSN_ID,\n  COUNT(DISTINCT HSP_ACCOUNT_ID) as har_count\nFROM PAT_ENC\nWHERE HSP_ACCOUNT_ID IS NOT NULL\nGROUP BY PAT_ENC_CSN_ID\nHAVING COUNT(DISTINCT HSP_ACCOUNT_ID) > 1;",
    "description": "Multiple HARs per encounter (should be 0)",
    "chapterId": "02.2-the-identifier-trinity",
    "index": 13,
    "results": [],
    "columns": [],
    "error": null
  }
]