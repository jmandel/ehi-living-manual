# Chapter 3.1: Patients and Encounters

*Purpose: Master the foundation of Epic's clinical data model by understanding how patient demographics connect to their healthcare journey through encounters.*

### The Foundation: PATIENT Table

The `PATIENT` table is your demographic bedrock. Every person who has ever been a patient at your healthcare organization has exactly one row here. Think of it as the master directory—everything else links back to this.

<example-query description="View core patient demographics">
-- Every patient has one row with basic demographics
SELECT 
  PAT_ID,
  PAT_NAME,
  BIRTH_DATE,
  -- Key identifiers
  SSN,
  MEDICARE_NUM,
  MEDICAID_NUM,
  -- Location info
  CITY,
  STATE_C_NAME,
  ZIP,
  -- Contact
  HOME_PHONE,
  EMAIL_ADDRESS
FROM PATIENT
WHERE PAT_ID = '28411874';
</example-query>

#### Patient Identifiers: Your Keys to the Kingdom

Epic uses multiple identifiers for patients. Understanding when to use each is crucial:

**PAT_ID**: The internal Epic patient identifier. This is what you'll join on everywhere.

**Medical Record Number (MRN)**: The number patients see on their wristbands and paperwork. In Epic's tables, you'll find this in `PATIENT.PAT_MRN_ID`. One critical detail: MRNs are only unique within a single facility, not across a health system.

**External Identifiers**: Medicare, Medicaid, and SSN are stored but should be handled with extreme care due to PHI regulations.

<example-query description="Explore patient identifier patterns">
-- See how different identifiers are stored
SELECT 
  PAT_ID,
  PAT_MRN_ID,
  -- Government identifiers (handle with care!)
  CASE WHEN SSN IS NOT NULL THEN 'Has SSN' ELSE 'No SSN' END as ssn_status,
  CASE WHEN MEDICARE_NUM IS NOT NULL THEN 'Has Medicare' ELSE 'No Medicare' END as medicare_status,
  CASE WHEN MEDICAID_NUM IS NOT NULL THEN 'Has Medicaid' ELSE 'No Medicaid' END as medicaid_status
FROM PATIENT
WHERE PAT_ID = '28411874';
</example-query>

#### Names: More Complex Than You Think

Patient names in Epic follow specific patterns that reflect real-world complexity:

<example-query description="Understand patient name components">
-- Patient names can have many variations
SELECT 
  p.PAT_ID,
  p.PAT_NAME,                    -- "Lastname, Firstname MI" format
  p.PAT_FIRST_NAME,
  p.PAT_MIDDLE_NAME,
  p.PAT_LAST_NAME,
  -- Additional name fields from PATIENT_3
  p3.PREFERRED_NAME              -- What they want to be called
FROM PATIENT p
LEFT JOIN PATIENT_3 p3 ON p.PAT_ID = p3.PAT_ID
WHERE p.PAT_ID = '28411874';
</example-query>

### The Hub: PAT_ENC Table

If `PATIENT` is your directory, then `PAT_ENC` (Patient Encounter) is your activity log. Every interaction between a patient and your healthcare system generates a row here.

<example-query description="Explore encounter basics">
-- Each row is one patient interaction
SELECT 
  PAT_ENC_CSN_ID,              -- The golden key!
  CONTACT_DATE,
  APPT_STATUS_C_NAME,          -- Scheduled, Completed, Canceled, No Show
  DEPARTMENT_ID,
  VISIT_PROV_ID,               -- Primary provider for this visit
  -- Hospital-specific fields
  HOSP_ADMSN_TIME,             -- When admitted
  HOSP_DISCHRG_TIME            -- When discharged
FROM PAT_ENC
WHERE PAT_ID = '28411874'
ORDER BY CONTACT_DATE DESC
LIMIT 10;
</example-query>

#### The Magic of CSN (Contact Serial Number)

The **CSN** is Epic's unique encounter identifier. Every appointment, visit, admission, phone call, or video visit gets a unique CSN. This number is:
- Globally unique across your entire Epic system
- Never reused
- Your primary key for joining clinical data

The `PAT_ENC_DATE_REAL` field encodes both date and sequence:
- Integer portion: Days since 1840 (Epic's epoch)
- Decimal portion: Sequence for multiple encounters on same day

<example-query description="Decode the date encoding">
-- See how Epic handles multiple encounters per day
SELECT 
  PAT_ENC_CSN_ID,
  PAT_ENC_DATE_REAL,
  CONTACT_DATE,
  -- Extract components
  CAST(PAT_ENC_DATE_REAL AS INTEGER) as date_portion,
  ROUND((PAT_ENC_DATE_REAL - CAST(PAT_ENC_DATE_REAL AS INTEGER)) * 100, 0) as sequence
FROM PAT_ENC
WHERE PAT_ID = '28411874'
  AND PAT_ENC_DATE_REAL != CAST(PAT_ENC_DATE_REAL AS INTEGER)  -- Has decimal
ORDER BY PAT_ENC_DATE_REAL;
</example-query>

#### Encounter Status: Not All Visits Happen

The `APPT_STATUS_C_NAME` field reveals the reality of healthcare scheduling:

<example-query description="Analyze appointment completion patterns">
-- See the full lifecycle of scheduled healthcare
SELECT 
  APPT_STATUS_C_NAME,
  COUNT(*) as encounter_count,
  -- Calculate rates
  ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 1) as percentage
FROM PAT_ENC
WHERE PAT_ID = '28411874'
GROUP BY APPT_STATUS_C_NAME
ORDER BY encounter_count DESC;
</example-query>

### Linking Clinical Context

Encounters are just timestamps without clinical context. The real power comes from joining to related tables.

#### Primary Diagnosis per Encounter

Each encounter can have multiple diagnoses, but one is marked as primary:

<example-query description="Find primary diagnoses across encounters">
-- The primary diagnosis drives billing and reporting
SELECT 
  pe.PAT_ENC_CSN_ID,
  pe.CONTACT_DATE,
  pe.DEPARTMENT_ID,
  dx.LINE,                     -- 1 = primary, 2+ = secondary
  dx.PRIMARY_DX_YN,            -- Explicit primary flag
  edg.DX_NAME
FROM PAT_ENC pe
JOIN PAT_ENC_DX dx ON pe.PAT_ENC_CSN_ID = dx.PAT_ENC_CSN_ID
JOIN CLARITY_EDG edg ON dx.DX_ID = edg.DX_ID
WHERE pe.PAT_ID = 'Z7004242'
  AND dx.PRIMARY_DX_YN = 'Y'
ORDER BY pe.CONTACT_DATE DESC
LIMIT 10;
</example-query>

#### All Diagnoses for an Encounter

Most encounters involve multiple issues. The `LINE` field maintains their order:

<example-query description="See complete diagnostic picture for a visit">
-- Multiple diagnoses paint the full clinical picture
SELECT 
  pe.PAT_ENC_CSN_ID,
  pe.CONTACT_DATE,
  dx.LINE,
  CASE 
    WHEN dx.PRIMARY_DX_YN = 'Y' THEN 'PRIMARY'
    ELSE 'Secondary'
  END as dx_role,
  edg.DX_NAME,
  dx.DX_CHRONIC_YN              -- Is this a chronic condition?
FROM PAT_ENC pe
JOIN PAT_ENC_DX dx ON pe.PAT_ENC_CSN_ID = dx.PAT_ENC_CSN_ID
JOIN CLARITY_EDG edg ON dx.DX_ID = edg.DX_ID
WHERE pe.PAT_ENC_CSN_ID = '988126821'
ORDER BY dx.LINE;
</example-query>

#### Encounter Providers: It Takes a Team

Healthcare is collaborative. Each encounter can involve multiple providers in different roles:

<example-query description="Identify the care team for encounters">
-- VISIT_PROV_ID is just the beginning
SELECT 
  pe.PAT_ENC_CSN_ID,
  pe.CONTACT_DATE,
  -- Primary visit provider
  pe.VISIT_PROV_ID,
  pe.VISIT_PROV_TITLE_NAME,
  -- Primary care provider at time of visit
  pe.PCP_PROV_ID,
  -- Supervising provider (from PAT_ENC_2)
  peh.SUP_PROV_ID,
  peh.SUP_PROV_C_NAME as supervising_provider_type
FROM PAT_ENC pe
LEFT JOIN PAT_ENC_2 peh ON pe.PAT_ENC_CSN_ID = peh.PAT_ENC_CSN_ID
WHERE pe.PAT_ID = 'Z7004242'
  AND pe.APPT_STATUS_C_NAME = 'Completed'
ORDER BY pe.CONTACT_DATE DESC
LIMIT 5;
</example-query>

### Building Patient Journeys

Individual encounters tell stories, but patterns reveal patient journeys.

#### Longitudinal Patient View

Track a patient's healthcare journey over time:

<example-query description="Build a patient's care timeline">
-- See the full patient journey
SELECT 
  CONTACT_DATE,
  PAT_ENC_CSN_ID,
  DEPARTMENT_ID,
  APPT_STATUS_C_NAME,
  -- Time between visits
  JULIANDAY(CONTACT_DATE) - 
    JULIANDAY(LAG(CONTACT_DATE) OVER (ORDER BY CONTACT_DATE)) as days_since_last_visit
FROM PAT_ENC
WHERE PAT_ID = '28411874'
  AND APPT_STATUS_C_NAME = 'Completed'
ORDER BY CONTACT_DATE DESC
LIMIT 20;
</example-query>

#### Care Patterns Analysis

Identify patterns in where patients receive care:

<example-query description="Analyze department utilization patterns">
-- Where does this patient go for care?
SELECT 
  pe.DEPARTMENT_ID,
  cd.DEPARTMENT_NAME,
  COUNT(*) as visit_count,
  MIN(pe.CONTACT_DATE) as first_visit,
  MAX(pe.CONTACT_DATE) as last_visit,
  -- Average time between visits to this department
  ROUND(
    JULIANDAY(MAX(pe.CONTACT_DATE)) - JULIANDAY(MIN(pe.CONTACT_DATE)) 
    / NULLIF(COUNT(*) - 1, 0), 
    1
  ) as avg_days_between_visits
FROM PAT_ENC pe
LEFT JOIN CLARITY_DEP cd ON pe.DEPARTMENT_ID = cd.DEPARTMENT_ID
WHERE pe.PAT_ID = 'Z7004242'
  AND pe.APPT_STATUS_C_NAME = 'Completed'
GROUP BY pe.DEPARTMENT_ID, cd.DEPARTMENT_NAME
HAVING COUNT(*) > 1  -- Departments visited multiple times
ORDER BY visit_count DESC;
</example-query>

### Hospital Encounters Deep Dive

Hospital encounters are special—they span days and involve complex workflows. The `PAT_ENC_HSP` table adds hospital-specific context:

#### Admission and Discharge Analysis

<example-query description="Calculate length of stay for admissions">
-- Hospital stays have duration
SELECT 
  pe.PAT_ENC_CSN_ID,
  pe.CONTACT_DATE,
  pe.HOSP_ADMSN_TIME,
  pe.HOSP_DISCHRG_TIME,
  -- Calculate length of stay
  ROUND(
    JULIANDAY(pe.HOSP_DISCHRG_TIME) - JULIANDAY(pe.HOSP_ADMSN_TIME), 
    1
  ) as length_of_stay_days,
  -- Get additional hospital details
  peh.ADT_PAT_CLASS_C_NAME,    -- Inpatient, Observation, etc.
  peh.ADMIT_SOURCE_C_NAME       -- Where patient came from
FROM PAT_ENC pe
JOIN PAT_ENC_HSP peh ON pe.PAT_ENC_CSN_ID = peh.PAT_ENC_CSN_ID
WHERE pe.HOSP_ADMSN_TIME IS NOT NULL
  AND pe.HOSP_DISCHRG_TIME IS NOT NULL
ORDER BY pe.HOSP_ADMSN_TIME DESC
LIMIT 10;
</example-query>

#### Emergency to Admission Flow

Many hospital admissions start in the Emergency Department:

<example-query description="Track ED to inpatient transitions">
-- See how patients flow through the hospital
SELECT 
  pe.PAT_ENC_CSN_ID,
  pe.CONTACT_DATE,
  peh.ADT_ARRIVAL_TIME as ed_arrival,
  pe.HOSP_ADMSN_TIME as admission_time,
  -- Time from ED arrival to admission
  ROUND(
    (JULIANDAY(pe.HOSP_ADMSN_TIME) - JULIANDAY(peh.ADT_ARRIVAL_TIME)) * 24, 
    1
  ) as ed_to_admit_hours,
  peh.ADT_PAT_CLASS_C_NAME
FROM PAT_ENC pe
JOIN PAT_ENC_HSP peh ON pe.PAT_ENC_CSN_ID = peh.PAT_ENC_CSN_ID
WHERE peh.ADT_ARRIVAL_TIME IS NOT NULL
  AND pe.HOSP_ADMSN_TIME IS NOT NULL
  AND peh.ADT_ARRIVAL_TIME < pe.HOSP_ADMSN_TIME
ORDER BY pe.CONTACT_DATE DESC
LIMIT 10;
</example-query>

### Complex Patient Scenarios

Real patients don't follow simple patterns. Here's how to handle complexity:

#### Multiple Active Problems

Patients with chronic conditions generate rich encounter histories:

<example-query description="Find patients with multiple chronic conditions">
-- Identify complex patients by their diagnosis patterns
WITH chronic_dx AS (
  SELECT 
    pe.PAT_ID,
    COUNT(DISTINCT edg.DX_NAME) as unique_chronic_conditions,
    GROUP_CONCAT(edg.DX_NAME, '; ') as chronic_conditions
  FROM PAT_ENC pe
  JOIN PAT_ENC_DX dx ON pe.PAT_ENC_CSN_ID = dx.PAT_ENC_CSN_ID
  JOIN CLARITY_EDG edg ON dx.DX_ID = edg.DX_ID
  WHERE dx.DX_CHRONIC_YN = 'Y'
    AND pe.CONTACT_DATE >= date('now', '-2 years')
  GROUP BY pe.PAT_ID
)
SELECT 
  p.PAT_ID,
  p.PAT_NAME,
  cd.unique_chronic_conditions,
  cd.chronic_conditions
FROM PATIENT p
JOIN chronic_dx cd ON p.PAT_ID = cd.PAT_ID
WHERE cd.unique_chronic_conditions >= 3
ORDER BY cd.unique_chronic_conditions DESC
LIMIT 10;
</example-query>

#### High Utilizers

Identify patients who frequently interact with the health system:

<example-query description="Find high-utilization patients">
-- Who uses the most healthcare resources?
WITH utilization AS (
  SELECT 
    PAT_ID,
    COUNT(DISTINCT PAT_ENC_CSN_ID) as total_encounters,
    COUNT(DISTINCT CASE 
      WHEN HOSP_ADMSN_TIME IS NOT NULL THEN PAT_ENC_CSN_ID 
    END) as hospital_admissions,
    COUNT(DISTINCT DATE(CONTACT_DATE)) as unique_contact_days,
    MIN(CONTACT_DATE) as first_contact,
    MAX(CONTACT_DATE) as last_contact
  FROM PAT_ENC
  WHERE APPT_STATUS_C_NAME = 'Completed'
    AND CONTACT_DATE >= date('now', '-1 year')
  GROUP BY PAT_ID
)
SELECT 
  p.PAT_ID,
  p.PAT_NAME,
  u.total_encounters,
  u.hospital_admissions,
  u.unique_contact_days,
  -- Encounters per month
  ROUND(
    u.total_encounters * 30.0 / 
    NULLIF(JULIANDAY(u.last_contact) - JULIANDAY(u.first_contact), 0), 
    1
  ) as encounters_per_month
FROM PATIENT p
JOIN utilization u ON p.PAT_ID = u.PAT_ID
WHERE u.total_encounters >= 10
ORDER BY u.total_encounters DESC
LIMIT 20;
</example-query>

### Data Quality Checks

Before trusting your analysis, validate data quality:

#### Encounter Integrity

<example-query description="Check for data quality issues">
-- Look for potential data problems
SELECT 
  'Missing department' as issue,
  COUNT(*) as count
FROM PAT_ENC
WHERE DEPARTMENT_ID IS NULL
  AND APPT_STATUS_C_NAME = 'Completed'

UNION ALL

SELECT 
  'Discharge before admission' as issue,
  COUNT(*) as count
FROM PAT_ENC
WHERE HOSP_DISCHRG_TIME < HOSP_ADMSN_TIME

UNION ALL

SELECT 
  'Missing visit provider' as issue,
  COUNT(*) as count
FROM PAT_ENC
WHERE VISIT_PROV_ID IS NULL
  AND APPT_STATUS_C_NAME = 'Completed'

UNION ALL

SELECT 
  'Future contact dates' as issue,
  COUNT(*) as count
FROM PAT_ENC
WHERE CONTACT_DATE > date('now');
</example-query>

#### Patient Demographics Completeness

<example-query description="Assess demographic data completeness">
-- How complete is our patient data?
SELECT 
  COUNT(*) as total_patients,
  -- Core identifiers
  SUM(CASE WHEN PAT_MRN_ID IS NOT NULL THEN 1 ELSE 0 END) as has_mrn,
  SUM(CASE WHEN SSN IS NOT NULL THEN 1 ELSE 0 END) as has_ssn,
  -- Demographics
  SUM(CASE WHEN BIRTH_DATE IS NOT NULL THEN 1 ELSE 0 END) as has_birth_date,
  SUM(CASE WHEN SEX_C_NAME_ IS NOT NULL THEN 1 ELSE 0 END) as has_sex,
  -- Contact info
  SUM(CASE WHEN EMAIL_ADDRESS IS NOT NULL THEN 1 ELSE 0 END) as has_email,
  SUM(CASE WHEN HOME_PHONE IS NOT NULL THEN 1 ELSE 0 END) as has_phone,
  -- Calculate percentages
  ROUND(100.0 * SUM(CASE WHEN EMAIL_ADDRESS IS NOT NULL THEN 1 ELSE 0 END) / COUNT(*), 1) as pct_with_email
FROM PATIENT;
</example-query>

---

### Key Takeaways

1. **PATIENT table is your demographic foundation** - One row per person, linked everywhere by PAT_ID

2. **PAT_ENC table is your clinical activity hub** - Every interaction creates a row with a unique CSN

3. **CSN links everything clinical** - Diagnoses, procedures, notes, orders all join through CSN

4. **Multiple providers per encounter is normal** - Visit provider, PCP, attending, consulting all have roles

5. **Hospital encounters are special** - They span time and have admission/discharge workflows

6. **The LINE pattern is everywhere** - Epic's way of handling one-to-many relationships

7. **Not all scheduled encounters happen** - Cancellations and no-shows are part of the data

8. **Chronic conditions drive utilization** - Patients with multiple conditions generate rich histories

9. **Data quality varies** - Always validate before drawing conclusions

10. **Patient journeys emerge from encounter patterns** - Individual visits tell stories; patterns reveal healthcare needs