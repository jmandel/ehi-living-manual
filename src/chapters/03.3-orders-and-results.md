# Chapter 3.3: Orders & Results

*Purpose: Learn how Epic tracks the complete lifecycle of clinical orders—from provider request through final results—and master the hierarchical component structure that makes lab panels and complex results manageable.*

### The Order Ecosystem: Your Clinical Command Center

Every clinical action starts with an order. Whether it's a simple lab test or a complex imaging study, Epic's order system orchestrates the entire workflow. The **ORDER_PROC** table serves as mission control, tracking every order from creation to completion.

<example-query description="See the variety of orders in the system">
SELECT 
  ORDER_TYPE_C_NAME,
  COUNT(*) as order_count,
  COUNT(DISTINCT PAT_ENC_CSN_ID) as encounters
FROM ORDER_PROC
GROUP BY ORDER_TYPE_C_NAME
ORDER BY order_count DESC;
</example-query>

**Key Insight**: Epic treats labs, imaging, referrals, and even some medications as "procedure orders." This unified approach means you can query diverse order types with consistent patterns.

### ORDER_PROC: The Master Table

Think of `ORDER_PROC` as the hub of a wheel, with spokes connecting to specialized tables for results, status updates, and order-specific details.

<example-query description="Examine the anatomy of a lab order">
SELECT 
  ORDER_PROC_ID,
  DESCRIPTION,
  ORDER_TYPE_C_NAME,
  ORDER_STATUS_C_NAME,
  LAB_STATUS_C_NAME,
  ORDERING_DATE,
  RESULT_DATE,
  AUTHRZING_PROV_ID,
  ABNORMAL_YN
FROM ORDER_PROC
WHERE ORDER_TYPE_C_NAME = 'Lab'
  AND ORDER_PROC_ID = 945468371;
</example-query>

**Critical Fields**:
- `ORDER_PROC_ID`: Your primary key for joining to results
- `PAT_ENC_CSN_ID`: Links back to the encounter
- `ORDER_STATUS_C_NAME`: Overall order state (Ordered, Completed, Canceled)
- `LAB_STATUS_C_NAME`: Lab-specific status (Preliminary, Final result)
- `ABNORMAL_YN`: Quick flag for any abnormal components

### The Order Lifecycle: From Request to Result

Orders progress through predictable states, tracked in the `ORDER_STATUS` table. Each state change creates a new row, building a complete audit trail.

<example-query description="Track an order's journey through status changes">
SELECT 
  os.ORDER_ID,
  os.CONTACT_TYPE_C_NAME as status,
  os.CONTACT_DATE,
  os.ORDER_CREATOR_ID_NAME as user_name,
  op.DESCRIPTION
FROM ORDER_STATUS os
JOIN ORDER_PROC op ON os.ORDER_ID = op.ORDER_PROC_ID
WHERE op.ORDER_TYPE_C_NAME = 'Lab'
  AND op.DESCRIPTION LIKE '%LIPID%'
ORDER BY os.ORDER_ID, os.ORD_DATE_REAL
LIMIT 10;
</example-query>

**Common Status Progression**:
1. **Ordered**: Provider places the order
2. **Specimen Collected**: For labs requiring samples
3. **In Process**: Lab begins analysis
4. **Resulted**: Results available
5. **Completed**: Provider has reviewed

### Understanding Lab Results: The Component Model

Here's where Epic shines. A single "Lipid Panel" order explodes into multiple measurable components, each tracked as a separate row in `ORDER_RESULTS`.

<example-query description="Decompose a lipid panel into its components">
SELECT 
  op.DESCRIPTION as panel_name,
  r.LINE,
  r.COMPONENT_ID_NAME as component,
  r.ORD_VALUE as value,
  r.REFERENCE_UNIT as units,
  r.REFERENCE_LOW || '-' || r.REFERENCE_HIGH as ref_range,
  CASE 
    WHEN r.RESULT_FLAG_C_NAME IS NULL THEN 'Normal'
    ELSE r.RESULT_FLAG_C_NAME 
  END as flag
FROM ORDER_PROC op
JOIN ORDER_RESULTS r ON op.ORDER_PROC_ID = r.ORDER_PROC_ID
WHERE op.ORDER_PROC_ID = 945468371
ORDER BY r.LINE;
</example-query>

**The Power of Components**:
- One order → multiple result rows
- Each component has its own reference range
- LINE field maintains display order
- Components can be queried independently

### Result Flags: Spotting the Abnormal

Epic uses a sophisticated flagging system to highlight values outside normal ranges. Any non-null value in `RESULT_FLAG_C_NAME` indicates an abnormality.

<example-query description="Find all abnormal results across orders">
SELECT 
  op.DESCRIPTION,
  r.COMPONENT_ID_NAME,
  r.ORD_VALUE,
  r.REFERENCE_UNIT,
  r.RESULT_FLAG_C_NAME,
  CASE
    WHEN r.ORD_NUM_VALUE > r.REFERENCE_HIGH THEN 
      ROUND((r.ORD_NUM_VALUE - r.REFERENCE_HIGH) / r.REFERENCE_HIGH * 100, 1) || '% above'
    WHEN r.ORD_NUM_VALUE < r.REFERENCE_LOW THEN
      ROUND((r.REFERENCE_LOW - r.ORD_NUM_VALUE) / r.REFERENCE_LOW * 100, 1) || '% below'
  END as variance
FROM ORDER_PROC op
JOIN ORDER_RESULTS r ON op.ORDER_PROC_ID = r.ORDER_PROC_ID
WHERE r.RESULT_FLAG_C_NAME IS NOT NULL
  AND r.ORD_NUM_VALUE != 9999999  -- Exclude non-numeric
ORDER BY op.ORDERING_DATE DESC
LIMIT 10;
</example-query>

**Flag Types You'll Encounter**:
- **High/Low**: Outside normal range
- **High Panic/Low Panic**: Critical values requiring immediate attention
- **Abnormal**: General flag for non-numeric results
- **High Off-Scale**: Beyond measurement capabilities

### Different Order Types, Different Tables

While `ORDER_PROC` handles most orders, medications follow their own path through `ORDER_MED`.

<example-query description="Compare procedure orders to medication orders">
-- Procedure orders (labs, imaging, etc.)
SELECT 'Procedures' as order_type, COUNT(*) as count
FROM ORDER_PROC
UNION ALL
-- Medication orders
SELECT 'Medications', COUNT(*)
FROM ORDER_MED;
</example-query>

**Key Differences**:
- **ORDER_PROC**: Labs, imaging, procedures, some injections
- **ORDER_MED**: Prescriptions and medication administrations
- Both link to encounters via `PAT_ENC_CSN_ID`
- Different status tracking mechanisms

### Medication Orders: A Different Beast

Medication orders have their own lifecycle, tracking from prescription through dispensing.

<example-query description="Explore medication order details">
SELECT 
  ORDER_MED_ID,
  DESCRIPTION,
  ORDER_STATUS_C_NAME,
  ORDERING_MODE_C_NAME,
  START_DATE,
  END_DATE,
  REFILLS,
  QUANTITY
FROM ORDER_MED
WHERE DESCRIPTION LIKE '%LISINOPRIL%'
ORDER BY ORDERING_DATE DESC
LIMIT 5;
</example-query>

**Medication-Specific Fields**:
- `ORDERING_MODE_C_NAME`: Inpatient vs Outpatient
- `START_DATE/END_DATE`: Duration of therapy
- `REFILLS`: Authorized refill count
- `SIG`: Full prescription instructions

### Working with Result Values

Result values require careful handling due to Epic's storage approach.

<example-query description="Handle different result value types">
SELECT 
  COMPONENT_ID_NAME,
  ORD_VALUE,
  ORD_NUM_VALUE,
  CASE
    WHEN ORD_NUM_VALUE = 9999999 THEN 'Text Result'
    WHEN ORD_NUM_VALUE IS NULL THEN 'No Value'
    ELSE 'Numeric: ' || CAST(ORD_NUM_VALUE AS TEXT)
  END as value_type,
  REFERENCE_UNIT
FROM ORDER_RESULTS
WHERE ORDER_PROC_ID IN (945468371, 945468372)
ORDER BY value_type, COMPONENT_ID_NAME;
</example-query>

**Value Storage Rules**:
- `ORD_VALUE`: Always populated, stored as text
- `ORD_NUM_VALUE`: Numeric conversion when possible
- **9999999**: Magic number indicating non-numeric result
- Decimals use period regardless of locale

### Turnaround Time Analysis

Understanding how long orders take to complete helps identify bottlenecks.

<example-query description="Calculate lab turnaround times">
SELECT 
  ORDER_TYPE_C_NAME,
  COUNT(*) as total_orders,
  ROUND(AVG(
    JULIANDAY(RESULT_DATE) - JULIANDAY(ORDERING_DATE)
  ) * 24, 1) as avg_hours,
  ROUND(MIN(
    JULIANDAY(RESULT_DATE) - JULIANDAY(ORDERING_DATE)
  ) * 24, 1) as min_hours,
  ROUND(MAX(
    JULIANDAY(RESULT_DATE) - JULIANDAY(ORDERING_DATE)
  ) * 24, 1) as max_hours
FROM ORDER_PROC
WHERE RESULT_DATE IS NOT NULL
  AND ORDERING_DATE IS NOT NULL
GROUP BY ORDER_TYPE_C_NAME
HAVING COUNT(*) > 2;
</example-query>

### Result Trending: Following Values Over Time

For chronic conditions, tracking result trends reveals clinical patterns.

<example-query description="Track hemoglobin A1C trends for diabetes monitoring">
WITH a1c_results AS (
  SELECT 
    op.PAT_ID,
    op.RESULT_DATE,
    r.ORD_VALUE as a1c_value,
    r.RESULT_FLAG_C_NAME
  FROM ORDER_PROC op
  JOIN ORDER_RESULTS r ON op.ORDER_PROC_ID = r.ORDER_PROC_ID
  WHERE op.DESCRIPTION LIKE '%A1C%'
    AND r.ORD_NUM_VALUE != 9999999
)
SELECT 
  PAT_ID,
  RESULT_DATE,
  a1c_value,
  RESULT_FLAG_C_NAME,
  LAG(a1c_value) OVER (PARTITION BY PAT_ID ORDER BY RESULT_DATE) as prev_value,
  ROUND(
    CAST(a1c_value AS FLOAT) - 
    CAST(LAG(a1c_value) OVER (PARTITION BY PAT_ID ORDER BY RESULT_DATE) AS FLOAT), 
    1
  ) as change
FROM a1c_results
ORDER BY PAT_ID, RESULT_DATE;
</example-query>

### Common Query Patterns

**Finding Orders for an Encounter**:
<example-query description="All orders for a specific encounter">
SELECT 
  ORDER_PROC_ID,
  ORDER_TYPE_C_NAME,
  DESCRIPTION,
  ORDER_STATUS_C_NAME,
  ORDERING_DATE
FROM ORDER_PROC
WHERE PAT_ENC_CSN_ID = 131130638
ORDER BY ORDERING_DATE;
</example-query>

**Getting Complete Results for an Order**:
<example-query description="Full result details including components">
SELECT 
  op.ORDER_PROC_ID,
  op.DESCRIPTION as test_name,
  r.LINE,
  r.COMPONENT_ID_NAME as component,
  r.ORD_VALUE || ' ' || r.REFERENCE_UNIT as result,
  CASE
    WHEN r.RESULT_FLAG_C_NAME IS NULL THEN 'Normal'
    ELSE r.RESULT_FLAG_C_NAME
  END as flag
FROM ORDER_PROC op
LEFT JOIN ORDER_RESULTS r ON op.ORDER_PROC_ID = r.ORDER_PROC_ID
WHERE op.ORDER_PROC_ID = 945468371
ORDER BY r.LINE;
</example-query>

### Data Quality Checks

Always validate your order data for completeness.

<example-query description="Find orders without results">
SELECT 
  ORDER_TYPE_C_NAME,
  COUNT(*) as orders_without_results
FROM ORDER_PROC op
LEFT JOIN ORDER_RESULTS r ON op.ORDER_PROC_ID = r.ORDER_PROC_ID
WHERE r.ORDER_PROC_ID IS NULL
  AND op.ORDER_STATUS_C_NAME = 'Completed'
GROUP BY ORDER_TYPE_C_NAME;
</example-query>

### Best Practices

1. **Always Join Through ORDER_PROC_ID**: This is your primary key to results
2. **Check ORD_NUM_VALUE for 9999999**: Indicates text results that need special handling
3. **Use LINE for Display Order**: Components should be shown in LINE sequence
4. **Filter by ORDER_TYPE**: Different types may have different result patterns
5. **Consider Status Hierarchies**: Lab status can differ from order status

### Watch Out For

- **Missing Results**: Not all completed orders have results in ORDER_RESULTS
- **Multiple Result Contacts**: Orders can be updated multiple times
- **Timezone Issues**: Result dates may not include time components
- **Component Variations**: Same test might have different components at different labs

---

### Key Takeaways

1. **ORDER_PROC** is your starting point for all non-medication clinical orders
2. **Results are hierarchical**: One order contains multiple component results
3. **The LINE pattern** maintains component order within results  
4. **Status tracking** happens at multiple levels (order, lab, result)
5. **Abnormal flags** provide quick identification of out-of-range values
6. **Different order types** may use specialized tables but follow similar patterns

### Next Steps
→ Continue to Chapter 3.4: Locations & ADT