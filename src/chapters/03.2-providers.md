# Chapter 3.2: Providers (CLARITY_SER)

*Purpose: Master the intricacies of Epic's provider model, learning how CLARITY_SER contains not just doctors, but everything that can be scheduled or take action in the system.*

### The Surprise: Not Just Doctors

When developers first encounter the `CLARITY_SER` table, they expect a straightforward list of physicians. What they find instead is Epic's ingenious solution to a complex problem: how do you model everything in healthcare that can take an action, be scheduled, or be assigned responsibility?

The answer is to expand the definition of "provider" far beyond human caregivers. In Epic's world, a **provider** is any entity that participates in the care process—whether that's a physician, a CT scanner, an operating room, or even an automated system interface.

<example-query description="Explore the diversity of providers in CLARITY_SER">
-- See the variety of "providers" in our sample data
SELECT 
  PROV_ID,
  PROV_NAME,
  CASE 
    WHEN PROV_NAME LIKE '%LAB%' THEN 'Laboratory/Resource'
    WHEN PROV_NAME LIKE '%GENERIC%' THEN 'System Provider'
    WHEN PROV_NAME LIKE '%MYCHART%' THEN 'Patient Portal'
    WHEN PROV_NAME LIKE '%NOT IN SYSTEM%' THEN 'Placeholder'
    ELSE 'Human Provider'
  END as provider_category
FROM CLARITY_SER
ORDER BY provider_category, PROV_NAME;
</example-query>

This design decision traces back to Epic's fundamental architecture principle: **unified scheduling and attribution**. Whether you're scheduling a patient with Dr. Smith, reserving OR 12, or attributing a lab result to the automated interface, the workflow is identical. This consistency drives efficiency across the entire system.

---

### Provider Types Decoded

#### Human Providers

The core of `CLARITY_SER` remains human caregivers—physicians, nurses, therapists, and other clinical staff. These providers have additional attributes that distinguish them from resources:

<example-query description="Identify human providers and their encounter volumes">
-- Human providers with their patient interaction counts
SELECT 
  s.PROV_ID,
  s.PROV_NAME,
  COUNT(DISTINCT pe.PAT_ENC_CSN_ID) as total_encounters,
  COUNT(DISTINCT pe.PAT_ID) as unique_patients
FROM CLARITY_SER s
LEFT JOIN PAT_ENC pe ON s.PROV_ID = pe.VISIT_PROV_ID
WHERE s.PROV_NAME NOT LIKE '%GENERIC%'
  AND s.PROV_NAME NOT LIKE '%LAB%'
  AND s.PROV_NAME NOT LIKE '%MYCHART%'
  AND s.PROV_NAME NOT LIKE '%NOT IN SYSTEM%'
GROUP BY s.PROV_ID, s.PROV_NAME
HAVING COUNT(pe.PAT_ENC_CSN_ID) > 0
ORDER BY total_encounters DESC;
</example-query>

#### System and Resource Providers

These non-human "providers" enable Epic to maintain consistency in how actions are attributed and resources are scheduled:

<example-query description="Examine system and resource providers">
-- System, resource, and placeholder providers
SELECT 
  PROV_ID,
  PROV_NAME,
  CASE
    WHEN PROV_ID = '3724611' THEN 'Laboratory Resource - handles lab orders'
    WHEN PROV_ID = '8800099' THEN 'External data interface - imports results'
    WHEN PROV_ID = 'E1011' THEN 'Patient portal - patient-entered data'
    WHEN PROV_ID = '199995' THEN 'Placeholder - unknown/missing provider'
  END as provider_purpose
FROM CLARITY_SER
WHERE PROV_NAME LIKE '%GENERIC%'
   OR PROV_NAME LIKE '%LAB%'
   OR PROV_NAME LIKE '%MYCHART%'
   OR PROV_NAME LIKE '%NOT IN SYSTEM%'
ORDER BY PROV_ID;
</example-query>

The **MAC LAB APL** provider (ID: 3724611) demonstrates how laboratories are modeled. When a lab test is ordered, it can be "scheduled" with this provider, and results can be attributed back to it. This maintains the same workflow patterns as scheduling with human providers.

---

### Provider Roles in Encounters

A single provider can play multiple roles across different encounters. Understanding these role distinctions is crucial for accurate reporting and analysis.

<example-query description="Analyze provider roles across encounters">
-- See how providers serve different roles
WITH provider_summary AS (
  SELECT 
    'Visit Provider' as role_type,
    VISIT_PROV_ID as prov_id,
    COUNT(*) as encounter_count
  FROM PAT_ENC
  WHERE VISIT_PROV_ID IS NOT NULL
  GROUP BY VISIT_PROV_ID
  
  UNION ALL
  
  SELECT 
    'Primary Care Provider' as role_type,
    PCP_PROV_ID as prov_id,
    COUNT(*) as encounter_count
  FROM PAT_ENC
  WHERE PCP_PROV_ID IS NOT NULL
  GROUP BY PCP_PROV_ID
)
SELECT 
  ps.role_type,
  s.PROV_NAME,
  ps.encounter_count
FROM provider_summary ps
JOIN CLARITY_SER s ON ps.prov_id = s.PROV_ID
ORDER BY ps.role_type, ps.encounter_count DESC;
</example-query>

#### Key Provider Roles

The `PAT_ENC` table tracks several provider relationships:

- **VISIT_PROV_ID**: The primary provider who saw the patient during this encounter
- **PCP_PROV_ID**: The patient's designated primary care provider (may not be the visit provider)
- **REFERRAL_SOURCE_ID_REFERRING_PROV_NAM**: Who referred the patient (stored as name, not ID in our sample)

Each role serves a distinct purpose in clinical workflows and downstream analytics.

---

### Provider-Department Relationships

Providers don't exist in isolation—they work within departments, and understanding these relationships is essential for operational reporting.

<example-query description="Map providers to their primary departments">
-- Provider-department affiliations
SELECT 
  s.PROV_NAME,
  d.DEPARTMENT_NAME,
  d.SPECIALTY_NAME,
  COUNT(DISTINCT pe.PAT_ENC_CSN_ID) as encounters_together
FROM PAT_ENC pe
JOIN CLARITY_SER s ON pe.VISIT_PROV_ID = s.PROV_ID
JOIN CLARITY_DEP d ON pe.DEPARTMENT_ID = d.DEPARTMENT_ID
GROUP BY s.PROV_NAME, d.DEPARTMENT_NAME, d.SPECIALTY_NAME
ORDER BY encounters_together DESC
LIMIT 10;
</example-query>

Notice how some providers work across multiple departments. Dr. Dhillon appears in both Internal Medicine and Business Services, reflecting the reality of clinical practice where providers may have administrative roles or work in multiple clinical settings.

---

### Provider Productivity Analysis

One of the most common uses of provider data is productivity analysis. Here's how to build meaningful provider metrics:

<example-query description="Calculate provider productivity metrics">
-- Provider productivity dashboard
SELECT 
  s.PROV_NAME,
  COUNT(DISTINCT pe.PAT_ENC_CSN_ID) as total_encounters,
  COUNT(DISTINCT pe.PAT_ID) as unique_patients,
  COUNT(DISTINCT pe.DEPARTMENT_ID) as departments_worked,
  COUNT(DISTINCT DATE(pe.CONTACT_DATE)) as days_worked,
  ROUND(CAST(COUNT(DISTINCT pe.PAT_ENC_CSN_ID) AS FLOAT) / 
        COUNT(DISTINCT DATE(pe.CONTACT_DATE)), 2) as avg_encounters_per_day
FROM CLARITY_SER s
JOIN PAT_ENC pe ON s.PROV_ID = pe.VISIT_PROV_ID
WHERE pe.CONTACT_DATE IS NOT NULL
  AND s.PROV_NAME NOT LIKE '%GENERIC%'
  AND s.PROV_NAME NOT LIKE '%LAB%'
GROUP BY s.PROV_NAME
HAVING COUNT(DISTINCT pe.PAT_ENC_CSN_ID) > 2
ORDER BY total_encounters DESC;
</example-query>

---

### Special Provider Scenarios

#### External Providers

External providers represent caregivers and facilities outside your organization. They're crucial for referral tracking and care coordination:

<example-query description="Identify external and referral relationships">
-- Find external provider patterns
SELECT 
  pe.REFERRAL_SOURCE_ID_REFERRING_PROV_NAM as referring_provider,
  s.PROV_NAME as visit_provider,
  COUNT(*) as referral_count
FROM PAT_ENC pe
JOIN CLARITY_SER s ON pe.VISIT_PROV_ID = s.PROV_ID
WHERE pe.REFERRAL_SOURCE_ID_REFERRING_PROV_NAM IS NOT NULL
  AND pe.REFERRAL_SOURCE_ID_REFERRING_PROV_NAM != ''
GROUP BY pe.REFERRAL_SOURCE_ID_REFERRING_PROV_NAM, s.PROV_NAME
ORDER BY referral_count DESC;
</example-query>

#### System-Generated Actions

When automated processes create orders or document results, they need attribution. System providers fill this role:

<example-query description="Track system provider activity">
-- System provider activity patterns
SELECT 
  s.PROV_NAME,
  d.DEPARTMENT_NAME,
  COUNT(*) as system_encounters,
  MIN(DATE(pe.CONTACT_DATE)) as first_activity,
  MAX(DATE(pe.CONTACT_DATE)) as last_activity
FROM PAT_ENC pe
JOIN CLARITY_SER s ON pe.VISIT_PROV_ID = s.PROV_ID
JOIN CLARITY_DEP d ON pe.DEPARTMENT_ID = d.DEPARTMENT_ID
WHERE s.PROV_NAME LIKE '%GENERIC%' 
   OR s.PROV_NAME LIKE '%MYCHART%'
GROUP BY s.PROV_NAME, d.DEPARTMENT_NAME
ORDER BY system_encounters DESC;
</example-query>

---

### Understanding Provider Identifiers

While Epic uses internal `PROV_ID` values, real-world integration often requires external identifiers. The most important is the **National Provider Identifier (NPI)**—a 10-digit, unique, government-issued number for healthcare providers.

Key facts about NPIs:
- **Format**: 10 digits, with a check digit for validation
- **Persistence**: Follows the provider regardless of employment or location changes
- **Types**: Type 1 (individuals) and Type 2 (organizations)
- **Required**: For all HIPAA-covered transactions

In a production Epic environment, you'd find NPI and other identifiers (DEA numbers, state licenses) in additional columns of `CLARITY_SER`. Our sample data omits these for privacy.

---

### Best Practices for Provider Queries

#### Always Filter by Provider Type When Possible

<example-query description="Demonstrate efficient provider filtering">
-- Efficient: Filter to human providers only
SELECT COUNT(*) as human_provider_count
FROM CLARITY_SER
WHERE PROV_NAME NOT LIKE '%GENERIC%'
  AND PROV_NAME NOT LIKE '%LAB%'
  AND PROV_NAME NOT LIKE '%MYCHART%'
  AND PROV_NAME NOT LIKE '%NOT IN SYSTEM%';
</example-query>

#### Use Consistent Join Patterns

When joining provider data, establish a consistent pattern based on the role you're analyzing:

<example-query description="Show standard provider join pattern">
-- Standard pattern for provider analysis
SELECT 
  pe.PAT_ENC_CSN_ID,
  pe.CONTACT_DATE,
  visit.PROV_NAME as visit_provider,
  pcp.PROV_NAME as primary_care_provider,
  d.DEPARTMENT_NAME
FROM PAT_ENC pe
LEFT JOIN CLARITY_SER visit ON pe.VISIT_PROV_ID = visit.PROV_ID
LEFT JOIN CLARITY_SER pcp ON pe.PCP_PROV_ID = pcp.PROV_ID
LEFT JOIN CLARITY_DEP d ON pe.DEPARTMENT_ID = d.DEPARTMENT_ID
WHERE pe.CONTACT_DATE >= '2023-01-01'
ORDER BY pe.CONTACT_DATE DESC
LIMIT 10;
</example-query>

---

### Key Takeaways

1. **CLARITY_SER is not just doctors**—it's a unified registry for anything that can be scheduled or take action in Epic
2. **Provider types include**: human caregivers, equipment/rooms, external facilities, and system processes
3. **Context determines role**—the same provider can be a visit provider, PCP, or referring provider in different encounters
4. **Department relationships** show where providers practice but aren't exclusive
5. **System providers** enable consistent attribution for automated processes
6. **External identifiers** like NPI are crucial for integration but may not appear in all exports

Understanding Epic's expanded definition of "provider" unlocks the ability to track every action and resource in the healthcare delivery process, from the emergency department physician to the MRI scanner to the interface that delivered the results.